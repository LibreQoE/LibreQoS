(()=>{function b(){let e=localStorage.getItem("theme");return e===null?window.matchMedia("(prefers-color-scheme: dark)").matches?(localStorage.setItem("theme","dark"),!0):(localStorage.setItem("theme","light"),!1):e==="dark"}var s=class{constructor(t){this.id=t,this.dom=document.getElementById(t),this.dom.classList.add("muted"),b()?(window.graphPalette=["#4992ff","#7cffb2","#fddd60","#ff6e76","#58d9f9","#05c091","#ff8a45","#8d48e3","#dd79ff"],this.chart=echarts.init(this.dom,"dark")):(window.graphPalette=["#d87c7c","#919e8b","#d7ab82","#6e7074","#61a0a8","#efa18d","#787464","#cc7e63","#724e58","#4b565b"],this.chart=echarts.init(this.dom,"vintage")),this.chart.showLoading(),this.option={},window.graphList===void 0?window.graphList=[this]:window.graphList.push(this)}onThemeChange(){}};function m(e,t){let r=0,n=0,l=0;return e<t/2?(r=255,n=Math.floor(255*e/(t/2))):(r=Math.floor(255*(t-e)/(t/2)),n=255),"rgb(".concat(r,", ").concat(n,", ").concat(l,")")}function k(){let e=localStorage.getItem("redact");if(e===null)return localStorage.setItem("redact","false"),!1;if(e==="false")return!1;if(e==="true")return!0}var f=[],a=0,h={},i=!1;function y(e){for(let t=0;t<f.length;t++)if(f[t][1].name===e)return t;return 0}var p=class extends s{constructor(t){super(t),this.option={series:[{nodeAlign:"left",type:"sankey",data:[],links:[]}]},this.option&&this.chart.setOption(this.option),this.chart.hideLoading(),this.chart.on("click",r=>{console.log(r.name),console.log(this.nodeMap);let n=r.name;n.indexOf(" > ")===-1?a=y(n):a=y(r.data.source)}),$("#btnRoot").click(()=>{a=0})}update(t,r){this.option.series[0].data=t,this.option.series[0].links=r,this.chart.hideLoading(),this.chart.setOption(this.option)}};function g(){$.get("/local-api/networkTree",e=>{let t=parseInt($("#cadence").val());if(i){setTimeout(g,t*1e3);return}f=e;let r=k();$("#rootNode").text(e[a][1].name);let n=[],l=[],x=e[a][1].parents.length-1;for(let o=0;o<e.length;o++){if(e[o][1].parents.length-x>c||a!==0&&!e[o][1].parents.includes(a))continue;let d=e[o][1].name,S=e[o][1].current_throughput[0]/1e6,w=e[o][1].max_throughput[0]/8,M=Math.min(100,S/w*100),I=m(100-M,100);e[o][1].rtts.length>0?h[d]=e[o][1].rtts[0]:h[d]=0;let L=m(200-h[d],200),u={fontSize:6,color:"#999"};if(r&&(u.backgroundColor=u.color),n.push({name:e[o][1].name,label:u,itemStyle:{color:L}}),o>0){let D=e[o][1].immediate_parent;l.push({source:e[D][1].name,target:e[o][1].name,value:e[o][1].current_throughput[0]+e[o][1].current_throughput[1],lineStyle:{color:I}})}}P.update(n,l),setTimeout(g,t*1e3)})}function E(){let e=10,t=localStorage.getItem("atsDepth");return t!==null?e=parseInt(t):localStorage.setItem("atsDepth",e.toString()),e}function v(){let e=document.getElementById("maxDepth");e.value=c,e.onclick=()=>{c=parseInt(e.value),localStorage.setItem("atsDepth",c.toString())}}var c=E();v();var P=new p("sankey");$("#btnPause").click(()=>{i=!i,i?$("#btnPause").html("<i class='fa fa-play'></i> Resume"):$("#btnPause").html("<i class='fa fa-pause'></i>Pause")});g();})();
//# sourceMappingURL=all_tree_sankey.js.map
