{
  "version": 3,
  "sources": ["../src/helpers/dark_mode.js", "../src/graphs/dashboard_graph.js", "../src/helpers/scaling.js", "../src/helpers/redact.js", "../src/all_tree_sankey.js"],
  "sourcesContent": ["export function initDayNightMode() {\n    if (isDarkMode()) {\n        const darkModeSwitch = document.getElementById('darkModeSwitch');\n        darkModeSwitch.checked = true;\n        document.body.classList.add('dark-mode');\n        document.documentElement.setAttribute('data-bs-theme', \"dark\");\n    } else {\n        document.body.classList.remove('dark-mode');\n        document.documentElement.setAttribute('data-bs-theme', \"light\");\n    }\n\n    document.addEventListener('DOMContentLoaded', (event) => {\n        const darkModeSwitch = document.getElementById('darkModeSwitch');\n        const currentTheme = localStorage.getItem('theme');\n\n        if (currentTheme === 'dark') {\n            document.body.classList.add('dark-mode');\n            darkModeSwitch.checked = true;\n        }\n\n        darkModeSwitch.addEventListener('change', () => {\n            if (darkModeSwitch.checked) {\n                document.body.classList.add('dark-mode');\n                document.documentElement.setAttribute('data-bs-theme', \"dark\");\n                localStorage.setItem('theme', 'dark');\n                window.graphPalette = [\n                    '#4992ff',\n                    '#7cffb2',\n                    '#fddd60',\n                    '#ff6e76',\n                    '#58d9f9',\n                    '#05c091',\n                    '#ff8a45',\n                    '#8d48e3',\n                    '#dd79ff'\n                ];\n            } else {\n                document.body.classList.remove('dark-mode');\n                document.documentElement.setAttribute('data-bs-theme', \"light\");\n                localStorage.setItem('theme', 'light');\n                window.graphPalette = [\n                    '#d87c7c',\n                    '#919e8b',\n                    '#d7ab82',\n                    '#6e7074',\n                    '#61a0a8',\n                    '#efa18d',\n                    '#787464',\n                    '#cc7e63',\n                    '#724e58',\n                    '#4b565b'\n                ];\n            }\n            if (window.graphList !== undefined) {\n                window.graphList.forEach((graph) => {\n                    graph.chart.dispose();\n                    if (darkModeSwitch.checked) {\n                        graph.chart = echarts.init(graph.dom, 'dark');\n                    } else {\n                        graph.chart = echarts.init(graph.dom, 'vintage');\n                    }\n                    graph.chart.setOption(graph.option);\n                    graph.onThemeChange();\n                });\n            }\n        });\n    });\n}\n\nexport function isDarkMode() {\n    const currentTheme = localStorage.getItem('theme');\n    if (currentTheme === null) {\n        if (window.matchMedia('(prefers-color-scheme: dark)').matches) {\n            localStorage.setItem('theme', 'dark');\n            return true;\n        } else {\n            localStorage.setItem('theme', 'light');\n            return false;\n        }\n    }\n    return currentTheme === 'dark';\n}", "import {isDarkMode} from \"../helpers/dark_mode\";\n\nexport class DashboardGraph {\n    constructor(id) {\n        this.id = id;\n        this.dom = document.getElementById(id);\n        this.dom.classList.add(\"muted\");\n        if (isDarkMode()) {\n            window.graphPalette = [\n                '#4992ff',\n                '#7cffb2',\n                '#fddd60',\n                '#ff6e76',\n                '#58d9f9',\n                '#05c091',\n                '#ff8a45',\n                '#8d48e3',\n                '#dd79ff'\n            ];\n            this.chart = echarts.init(this.dom, 'dark');\n        } else {\n            window.graphPalette = [\n                '#d87c7c',\n                '#919e8b',\n                '#d7ab82',\n                '#6e7074',\n                '#61a0a8',\n                '#efa18d',\n                '#787464',\n                '#cc7e63',\n                '#724e58',\n                '#4b565b'\n            ];\n            this.chart = echarts.init(this.dom, 'vintage');\n        }\n        this.chart.showLoading();\n        this.option = {};\n\n        // Apply to the global list of graphs\n        if (window.graphList === undefined) {\n            window.graphList = [ this ];\n        } else {\n            window.graphList.push(this);\n        }\n    }\n\n    onThemeChange() {\n        // Override this if you have to\n    }\n}", "export function scaleNumber(n, fixed=2) {\n    if (n > 1000000000000) {\n        return (n / 1000000000000).toFixed(fixed) + \"T\";\n    } else if (n > 1000000000) {\n        return (n / 1000000000).toFixed(fixed) + \"G\";\n    } else if (n > 1000000) {\n        return (n / 1000000).toFixed(fixed) + \"M\";\n    } else if (n > 1000) {\n        return (n / 1000).toFixed(fixed) + \"K\";\n    }\n    return n;\n}\n\nexport function scaleNanos(n, precision=2) {\n    if (n === 0) return \"-\";\n    if (n > 60000000000) {\n        return (n / 60000000000).toFixed(precision) + \"m\";\n    }else if (n > 1000000000) {\n        return (n / 1000000000).toFixed(precision) + \"s\";\n    } else if (n > 1000000) {\n        return (n / 1000000).toFixed(precision) + \"ms\";\n    } else if (n > 1000) {\n        return (n / 1000).toFixed(precision) + \"\u00B5s\";\n    }\n    return n + \"ns\";\n}\n\nexport function colorRamp(n) {\n    if (n <= 100) {\n        return \"#aaffaa\";\n    } else if (n <= 150) {\n        return \"goldenrod\";\n    } else {\n        return \"#ffaaaa\";\n    }\n}\n\nexport function rttCircleSpan(rtt) {\n    let span = document.createElement(\"span\");\n    span.style.color = colorRamp(rtt);\n    span.innerText = \"\u2B24\";\n    return span;\n}\n\nexport function lerpGreenToRedViaOrange(value, max) {\n    let r = 0;\n    let g = 0;\n    let b = 0;\n    if (value < max / 2) {\n        r = 255;\n        g = Math.floor(255 * value / (max / 2));\n    } else {\n        r = Math.floor(255 * (max - value) / (max / 2));\n        g = 255;\n    }\n    return `rgb(${r}, ${g}, ${b})`;\n}\n\nexport function formatThroughput(throughput, limitInMbps) {\n    let limitBits = limitInMbps * 1000 * 1000;\n    let percent = 0;\n    if (limitBits > 0) {\n        percent = (throughput / limitBits) * 100;\n    }\n    let color = lerpGreenToRedViaOrange(100-percent, 100);\n    let blob = \"<span class='muted' style='color: \" + color + \"'>\u25A0</span>\";\n    blob += \"<span>\" + scaleNumber(throughput, 1) + \"bps</span>\";\n    return blob;\n}\n\nexport function formatRtt(rtt) {\n    if (rtt === undefined || rtt === null || rtt.nanoseconds === 0) {\n        return \"-\";\n    }\n    const limit = 200;\n    let percent = 0;\n    if (limit > 0) {\n        percent = (rtt / limit) * 100;\n    }\n    let color = lerpGreenToRedViaOrange(100-percent, 100);\n    let blob = \"<span class='muted' style='color: \" + color + \"'>\u25A0</span>\";\n    blob += \"<span>\" + parseFloat(rtt).toFixed(0) + \"ms</span>\";\n    return blob;\n}\n\nexport function formatRetransmit(retransmits) {\n    let percent = Math.min(100, retransmits) / 100;\n    let color = lerpColor([0, 255, 0], [255, 0, 0], percent);\n    return \"<span class='muted' style='color: \" + color + \"'>\u25A0</span>\" + retransmits + \"</span>\";\n}\n\nexport function formatCakeStat(n) {\n    let percent = Math.min(100, n) / 100;\n    let color = lerpColor([128, 128, 0], [255, 255, 255], percent);\n    let html = \"<span class='muted' class='retransmits' style='color: \" + color + \"'>\";\n    html += n;\n    html += \"</span>\";\n    return html;\n}\n\nexport function lerpColor(color1, color2, weight) {\n    var r = Math.round(color1[0] + (color2[0] - color1[0]) * weight);\n    var g = Math.round(color1[1] + (color2[1] - color1[1]) * weight);\n    var b = Math.round(color1[2] + (color2[2] - color1[2]) * weight);\n    return `rgb(${r}, ${g}, ${b})`;\n}\n\nexport function formatPercent(percent, digits=0) {\n    let color = lerpGreenToRedViaOrange(100-Math.min(100,percent), 100);\n    return \"<span class='muted' style='color: \" + color + \"'>\" + percent.toFixed(digits) + \"%</span>\";\n}\n\nexport function rttNanosAsSpan(rttNanos, precision=0) {\n    let rttInMs = Math.min(200, rttNanos / 1000000);\n    let color = lerpGreenToRedViaOrange(200 - rttInMs, 200);\n    let html = \"<span class='muted' style='color: \" + color + \"'>\u25A0</span> \" + scaleNanos(rttNanos, precision);\n    return html;\n}", "export function initRedact() {\n    let modeSwitch = document.getElementById(\"redactSwitch\");\n    modeSwitch.checked = isRedacted();\n    modeSwitch.onclick = () => {\n        let modeSwitch = document.getElementById(\"redactSwitch\");\n        if (modeSwitch.checked) {\n            localStorage.setItem(\"redact\", \"true\");\n        } else {\n            localStorage.setItem(\"redact\", \"false\");\n        }\n        cssRedact();\n    };\n    cssRedact();\n}\n\nexport function redactCell(cell) {\n    cell.classList.add(\"redactable\");\n}\n\nfunction cssRedact() {\n    if (isRedacted()) {\n        let r = document.querySelector(':root');\n        r.style.setProperty('--redact', 'blur(8px)');\n    } else {\n        let r = document.querySelector(':root');\n        r.style.setProperty('--redact', 'none');\n    }\n}\n\nexport function isRedacted() {\n    let prefs = localStorage.getItem(\"redact\");\n    if (prefs === null) {\n        localStorage.setItem(\"redact\", \"false\");\n        return false;\n    }\n    if (prefs === \"false\") {\n        return false;\n    }\n    if (prefs === \"true\") {\n        return true;\n    }\n}\n", "import { DashboardGraph } from \"./graphs/dashboard_graph\";\nimport {lerpGreenToRedViaOrange} from \"./helpers/scaling\";\nimport {isRedacted} from \"./helpers/redact\";\n\nvar allNodes = [];\nlet rootId = 0;\nlet lastRtt = {};\nlet paused = false;\n\nfunction idOfNode(name) {\n    for (let i=0; i<allNodes.length; i++) {\n        if (allNodes[i][1].name === name) {\n            return i;\n        }\n    }\n    return 0;\n}\n\nclass AllTreeSankey extends DashboardGraph {\n    constructor(id) {\n        super(id);\n        this.option = {\n            series: [\n                {\n                    nodeAlign: 'left',\n                    type: 'sankey',\n                    data: [],\n                    links: []\n                }\n            ]\n        };\n        this.option && this.chart.setOption(this.option);\n        this.chart.hideLoading();\n        this.chart.on('click', (params) => {\n            console.log(params.name);\n            console.log(this.nodeMap);\n            let name = params.name;\n            // If it contains a >, it's a link\n            if (name.indexOf(\" > \") === -1) {\n                rootId = idOfNode(name);\n            } else {\n                rootId = idOfNode(params.data.source);\n            }\n        });\n        $(\"#btnRoot\").click(() => { rootId = 0; });\n    }\n\n    update(data, links) {\n        this.option.series[0].data = data;\n        this.option.series[0].links = links;\n        this.chart.hideLoading();\n        this.chart.setOption(this.option);\n    }\n}\n\nfunction start() {\n    $.get(\"/local-api/networkTree\", (data) => {\n        let cadence = parseInt($(\"#cadence\").val());\n        if (paused) {\n            setTimeout(start, cadence * 1000);\n            return;\n        }\n        allNodes = data;\n        //console.log(data);\n        let redact = isRedacted();\n        $(\"#rootNode\").text(data[rootId][1].name);\n\n        let nodes = [];\n        let links = [];\n\n        let startDepth = data[rootId][1].parents.length - 1;\n\n        for (let i=0; i<data.length; i++) {\n            let depth = data[i][1].parents.length - startDepth;\n            if (depth > maxDepth) {\n                continue;\n            }\n            // If data[i][1].parents does not contain rootId, skip\n            if (rootId !== 0 && !data[i][1].parents.includes(rootId)) {\n                continue;\n            }\n            let name = data[i][1].name;\n            let bytes = data[i][1].current_throughput[0];\n            let bytesAsMegabits = bytes / 1000000;\n            let maxBytes = data[i][1].max_throughput[0] / 8;\n            let percent = Math.min(100, (bytesAsMegabits / maxBytes) * 100);\n            let capacityColor = lerpGreenToRedViaOrange(100 - percent, 100);\n\n\n            if (data[i][1].rtts.length > 0) {\n                lastRtt[name] = data[i][1].rtts[0];\n            } else {\n                lastRtt[name] = 0;\n            }\n            let color = lerpGreenToRedViaOrange(200 - lastRtt[name], 200);\n\n            let label = {\n                fontSize: 6,\n                color: \"#999\"\n            };\n            if (redact) label.backgroundColor = label.color;\n\n            nodes.push({\n                name: data[i][1].name,\n                label: label,\n                itemStyle: {\n                    color: color\n                }\n            });\n\n            if (i > 0) {\n                let immediateParent = data[i][1].immediate_parent;\n                links.push({\n                    source: data[immediateParent][1].name,\n                    target: data[i][1].name,\n                    value: data[i][1].current_throughput[0] + data[i][1].current_throughput[1],\n                    lineStyle: {\n                        color: capacityColor,\n                    }\n                });\n            }\n        }\n\n        graph.update(nodes, links);\n        setTimeout(start, cadence * 1000);\n    });\n}\n\nfunction getMaxDepth() {\n    let maxDepth = 10;\n    let storedDepth = localStorage.getItem(\"atsDepth\");\n    if (storedDepth !== null) {\n        maxDepth = parseInt(storedDepth);\n    } else {\n        localStorage.setItem(\"atsDepth\", maxDepth.toString());\n    }\n    return maxDepth;\n}\n\nfunction bindMaxDepth() {\n    let d = document.getElementById(\"maxDepth\");\n    d.value = maxDepth;\n    d.onclick = () => {\n        maxDepth = parseInt(d.value);\n        localStorage.setItem(\"atsDepth\", maxDepth.toString());\n    };\n}\n\nlet maxDepth = getMaxDepth();\nbindMaxDepth();\nlet graph = new AllTreeSankey(\"sankey\");\n\n$(\"#btnPause\").click(() => {\n    paused = !paused;\n    if (paused) {\n        $(\"#btnPause\").html(\"<i class='fa fa-play'></i> Resume\");\n    } else {\n        $(\"#btnPause\").html(\"<i class='fa fa-pause'></i>Pause\");\n    }\n});\n\nstart();"],
  "mappings": "MAqEO,SAASA,GAAa,CACzB,IAAMC,EAAe,aAAa,QAAQ,OAAO,EACjD,OAAIA,IAAiB,KACb,OAAO,WAAW,8BAA8B,EAAE,SAClD,aAAa,QAAQ,QAAS,MAAM,EAC7B,KAEP,aAAa,QAAQ,QAAS,OAAO,EAC9B,IAGRA,IAAiB,MAC5B,CC/EO,IAAMC,EAAN,KAAqB,CACxB,YAAYC,EAAI,CACZ,KAAK,GAAKA,EACV,KAAK,IAAM,SAAS,eAAeA,CAAE,EACrC,KAAK,IAAI,UAAU,IAAI,OAAO,EAC1BC,EAAW,GACX,OAAO,aAAe,CAClB,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,SACJ,EACA,KAAK,MAAQ,QAAQ,KAAK,KAAK,IAAK,MAAM,IAE1C,OAAO,aAAe,CAClB,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,SACJ,EACA,KAAK,MAAQ,QAAQ,KAAK,KAAK,IAAK,SAAS,GAEjD,KAAK,MAAM,YAAY,EACvB,KAAK,OAAS,CAAC,EAGX,OAAO,YAAc,OACrB,OAAO,UAAY,CAAE,IAAK,EAE1B,OAAO,UAAU,KAAK,IAAI,CAElC,CAEA,eAAgB,CAEhB,CACJ,ECLO,SAASC,EAAwBC,EAAOC,EAAK,CAChD,IAAI,EAAI,EACJC,EAAI,EACJC,EAAI,EACR,OAAIH,EAAQC,EAAM,GACd,EAAI,IACJC,EAAI,KAAK,MAAM,IAAMF,GAASC,EAAM,EAAE,IAEtC,EAAI,KAAK,MAAM,KAAOA,EAAMD,IAAUC,EAAM,EAAE,EAC9CC,EAAI,KAED,OAAO,SAAC,MAAK,OAAAA,EAAC,MAAK,OAAAC,EAAC,IAC/B,CC3BO,SAASC,GAAa,CACzB,IAAIC,EAAQ,aAAa,QAAQ,QAAQ,EACzC,GAAIA,IAAU,KACV,oBAAa,QAAQ,SAAU,OAAO,EAC/B,GAEX,GAAIA,IAAU,QACV,MAAO,GAEX,GAAIA,IAAU,OACV,MAAO,EAEf,CCrCA,IAAIC,EAAW,CAAC,EACZC,EAAS,EACTC,EAAU,CAAC,EACXC,EAAS,GAEb,SAASC,EAASC,EAAM,CACpB,QAASC,EAAE,EAAGA,EAAEN,EAAS,OAAQM,IAC7B,GAAIN,EAASM,CAAC,EAAE,CAAC,EAAE,OAASD,EACxB,OAAOC,EAGf,MAAO,EACX,CAEA,IAAMC,EAAN,cAA4BC,CAAe,CACvC,YAAYC,EAAI,CACZ,MAAMA,CAAE,EACR,KAAK,OAAS,CACV,OAAQ,CACJ,CACI,UAAW,OACX,KAAM,SACN,KAAM,CAAC,EACP,MAAO,CAAC,CACZ,CACJ,CACJ,EACA,KAAK,QAAU,KAAK,MAAM,UAAU,KAAK,MAAM,EAC/C,KAAK,MAAM,YAAY,EACvB,KAAK,MAAM,GAAG,QAAUC,GAAW,CAC/B,QAAQ,IAAIA,EAAO,IAAI,EACvB,QAAQ,IAAI,KAAK,OAAO,EACxB,IAAIL,EAAOK,EAAO,KAEdL,EAAK,QAAQ,KAAK,IAAM,GACxBJ,EAASG,EAASC,CAAI,EAEtBJ,EAASG,EAASM,EAAO,KAAK,MAAM,CAE5C,CAAC,EACD,EAAE,UAAU,EAAE,MAAM,IAAM,CAAET,EAAS,CAAG,CAAC,CAC7C,CAEA,OAAOU,EAAMC,EAAO,CAChB,KAAK,OAAO,OAAO,CAAC,EAAE,KAAOD,EAC7B,KAAK,OAAO,OAAO,CAAC,EAAE,MAAQC,EAC9B,KAAK,MAAM,YAAY,EACvB,KAAK,MAAM,UAAU,KAAK,MAAM,CACpC,CACJ,EAEA,SAASC,GAAQ,CACb,EAAE,IAAI,yBAA2BF,GAAS,CACtC,IAAIG,EAAU,SAAS,EAAE,UAAU,EAAE,IAAI,CAAC,EAC1C,GAAIX,EAAQ,CACR,WAAWU,EAAOC,EAAU,GAAI,EAChC,MACJ,CACAd,EAAWW,EAEX,IAAII,EAASC,EAAW,EACxB,EAAE,WAAW,EAAE,KAAKL,EAAKV,CAAM,EAAE,CAAC,EAAE,IAAI,EAExC,IAAIgB,EAAQ,CAAC,EACTL,EAAQ,CAAC,EAETM,EAAaP,EAAKV,CAAM,EAAE,CAAC,EAAE,QAAQ,OAAS,EAElD,QAASK,EAAE,EAAGA,EAAEK,EAAK,OAAQL,IAAK,CAM9B,GALYK,EAAKL,CAAC,EAAE,CAAC,EAAE,QAAQ,OAASY,EAC5BC,GAIRlB,IAAW,GAAK,CAACU,EAAKL,CAAC,EAAE,CAAC,EAAE,QAAQ,SAASL,CAAM,EACnD,SAEJ,IAAII,EAAOM,EAAKL,CAAC,EAAE,CAAC,EAAE,KAElBc,EADQT,EAAKL,CAAC,EAAE,CAAC,EAAE,mBAAmB,CAAC,EACb,IAC1Be,EAAWV,EAAKL,CAAC,EAAE,CAAC,EAAE,eAAe,CAAC,EAAI,EAC1CgB,EAAU,KAAK,IAAI,IAAMF,EAAkBC,EAAY,GAAG,EAC1DE,EAAgBC,EAAwB,IAAMF,EAAS,GAAG,EAG1DX,EAAKL,CAAC,EAAE,CAAC,EAAE,KAAK,OAAS,EACzBJ,EAAQG,CAAI,EAAIM,EAAKL,CAAC,EAAE,CAAC,EAAE,KAAK,CAAC,EAEjCJ,EAAQG,CAAI,EAAI,EAEpB,IAAIoB,EAAQD,EAAwB,IAAMtB,EAAQG,CAAI,EAAG,GAAG,EAExDqB,EAAQ,CACR,SAAU,EACV,MAAO,MACX,EAWA,GAVIX,IAAQW,EAAM,gBAAkBA,EAAM,OAE1CT,EAAM,KAAK,CACP,KAAMN,EAAKL,CAAC,EAAE,CAAC,EAAE,KACjB,MAAOoB,EACP,UAAW,CACP,MAAOD,CACX,CACJ,CAAC,EAEGnB,EAAI,EAAG,CACP,IAAIqB,EAAkBhB,EAAKL,CAAC,EAAE,CAAC,EAAE,iBACjCM,EAAM,KAAK,CACP,OAAQD,EAAKgB,CAAe,EAAE,CAAC,EAAE,KACjC,OAAQhB,EAAKL,CAAC,EAAE,CAAC,EAAE,KACnB,MAAOK,EAAKL,CAAC,EAAE,CAAC,EAAE,mBAAmB,CAAC,EAAIK,EAAKL,CAAC,EAAE,CAAC,EAAE,mBAAmB,CAAC,EACzE,UAAW,CACP,MAAOiB,CACX,CACJ,CAAC,CACL,CACJ,CAEAK,EAAM,OAAOX,EAAOL,CAAK,EACzB,WAAWC,EAAOC,EAAU,GAAI,CACpC,CAAC,CACL,CAEA,SAASe,GAAc,CACnB,IAAIV,EAAW,GACXW,EAAc,aAAa,QAAQ,UAAU,EACjD,OAAIA,IAAgB,KAChBX,EAAW,SAASW,CAAW,EAE/B,aAAa,QAAQ,WAAYX,EAAS,SAAS,CAAC,EAEjDA,CACX,CAEA,SAASY,GAAe,CACpB,IAAIC,EAAI,SAAS,eAAe,UAAU,EAC1CA,EAAE,MAAQb,EACVa,EAAE,QAAU,IAAM,CACdb,EAAW,SAASa,EAAE,KAAK,EAC3B,aAAa,QAAQ,WAAYb,EAAS,SAAS,CAAC,CACxD,CACJ,CAEA,IAAIA,EAAWU,EAAY,EAC3BE,EAAa,EACb,IAAIH,EAAQ,IAAIrB,EAAc,QAAQ,EAEtC,EAAE,WAAW,EAAE,MAAM,IAAM,CACvBJ,EAAS,CAACA,EACNA,EACA,EAAE,WAAW,EAAE,KAAK,mCAAmC,EAEvD,EAAE,WAAW,EAAE,KAAK,kCAAkC,CAE9D,CAAC,EAEDU,EAAM",
  "names": ["isDarkMode", "currentTheme", "DashboardGraph", "id", "isDarkMode", "lerpGreenToRedViaOrange", "value", "max", "g", "b", "isRedacted", "prefs", "allNodes", "rootId", "lastRtt", "paused", "idOfNode", "name", "i", "AllTreeSankey", "DashboardGraph", "id", "params", "data", "links", "start", "cadence", "redact", "isRedacted", "nodes", "startDepth", "maxDepth", "bytesAsMegabits", "maxBytes", "percent", "capacityColor", "lerpGreenToRedViaOrange", "color", "label", "immediateParent", "graph", "getMaxDepth", "storedDepth", "bindMaxDepth", "d"]
}
