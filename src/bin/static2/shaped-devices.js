(()=>{function F(e,t=2){return e>1e12?(e/1e12).toFixed(t)+"T":e>1e9?(e/1e9).toFixed(t)+"G":e>1e6?(e/1e6).toFixed(t)+"M":e>1e3?(e/1e3).toFixed(t)+"K":e}function M(e,t=2){return e===0?"-":e>6e10?(e/6e10).toFixed(t)+"m":e>1e9?(e/1e9).toFixed(t)+"s":e>1e6?(e/1e6).toFixed(t)+"ms":e>1e3?(e/1e3).toFixed(t)+"\xB5s":e+"ns"}function S(e,t){let n=0,l=0,r=0;return e<t/2?(n=255,l=Math.floor(255*e/(t/2))):(n=Math.floor(255*(t-e)/(t/2)),l=255),"rgb(".concat(n,", ").concat(l,", ").concat(r,")")}function f(e,t){let n=t*1e3*1e3,l=0;n>0&&(l=e/n*100);let i="<span class='muted' style='color: "+S(100-l,100)+"'>\u25A0</span>";return i+="<span>"+F(e,1)+"bps</span>",i}function h(e){if(e==null||e.nanoseconds===0)return"-";let t=200,n=0;t>0&&(n=e/t*100);let r="<span class='muted' style='color: "+S(100-n,100)+"'>\u25A0</span>";return r+="<span>"+parseFloat(e).toFixed(0)+"ms</span>",r}function _(e){let t=Math.min(100,e)/100;return"<span class='muted' style='color: "+U([0,255,0],[255,0,0],t)+"'>\u25A0</span>"+e+"</span>"}function U(e,t,n){var l=Math.round(e[0]+(t[0]-e[0])*n),r=Math.round(e[1]+(t[1]-e[1])*n),i=Math.round(e[2]+(t[2]-e[2])*n);return"rgb(".concat(l,", ").concat(r,", ").concat(i,")")}function s(e,t=0,n="",l=""){let r=document.createElement("th");return r.classList.add("text-center"),l!==""&&(r.id=l),t>0&&(r.colSpan=t),n!==""?(r.setAttribute("data-bs-toggle","tooltip"),r.setAttribute("data-bs-placement","top"),r.setAttribute("data-bs-html","true"),r.setAttribute("title",n),r.innerHTML=e+" <i class='fas fa-info-circle'></i>"):r.innerText=e,r}function L(e,t=!1){let n=document.createElement("td");return t&&n.classList.add("redactable"),n.innerText=e,n}function H(e,t=0){for(;e.children.length>t;)e.removeChild(e.lastChild)}function D(){let e=document.createElement("thead");return e.appendChild(s("Circuit")),e.appendChild(s("Device")),e.appendChild(s("Plan (Mbps)")),e.appendChild(s("Parent")),e.appendChild(s("IP")),e.appendChild(s("Last Seen")),e.appendChild(s("Throughput",2)),e.appendChild(s("RTT",2)),e.appendChild(s("Re-Xmit",2)),e}function I(e){let t=3e11,n="-";return e>t?n="> 5 Minutes ago":n=M(e,0)+" ago",n}var d=null;function B(){return window.location.protocl==="https"?"wss://":"ws://"}function R(e,t){d&&d.close(),d=new WebSocket(B()+window.location.host+"/websocket/ws"),d.onopen=()=>{for(let n=0;n<e.length;n++)d.send('{ "channel" : "'+e[n]+'"}')},d.onclose=()=>{d=null},d.onerror=n=>{d=null},d.onmessage=function(n){let l=JSON.parse(n.data);t(l)}}var T=null,p=null,y=10,u=0,b="";function P(e){let t=document.createElement("tr");e.circuit_id!==""&&(t.id="row_"+e.circuit_id);let n=document.createElement("a");n.href="circuit.html?id="+e.circuit_id,n.innerText=e.circuit_name,n.classList.add("redactable");let l=document.createElement("td");l.appendChild(n),t.appendChild(l),n=document.createElement("a"),n.href="circuit.html?id="+e.circuit_id,n.innerText=e.device_name,n.classList.add("redactable"),l=document.createElement("td"),l.appendChild(n),t.appendChild(l),t.appendChild(L(e.download_max_mbps+" / "+e.upload_max_mbps)),t.appendChild(L(e.parent_node,!0));let r="";e.ipv4.forEach(m=>{r+=m[0]+"/"+m[1]+"<br />"}),e.ipv6.forEach(m=>{r+=m[0]+"/"+m[1]+"<br />"});let i=document.createElement("td");i.innerHTML=r,t.appendChild(i);let c=document.createElement("td");e.circuit_id!==""&&(c.id="lastSeen_"+e.circuit_id),c.innerHTML="-",t.appendChild(c);let o=document.createElement("td");e.circuit_id!==""&&(o.id="throughputDown_"+e.circuit_id),o.innerHTML="-",t.appendChild(o);let a=document.createElement("td");e.circuit_id!==""&&(a.id="throughputUp_"+e.circuit_id),a.innerHTML="-",t.appendChild(a);let E=document.createElement("td");e.circuit_id!==""&&(E.id="rttDown_"+e.circuit_id),E.innerHTML="-",t.appendChild(E);let g=document.createElement("td");e.circuit_id!==""&&(g.id="rttUp_"+e.circuit_id),g.innerHTML="-",t.appendChild(g);let x=document.createElement("td");e.circuit_id!==""&&(x.id="reXmitDown_"+e.circuit_id),x.innerHTML="-",t.appendChild(x);let w=document.createElement("td");return e.circuit_id!==""&&(w.id="reXmitUp_"+e.circuit_id),w.innerHTML="-",t.appendChild(w),t}function N(){let e=document.createElement("table");e.classList.add("table","table-striped"),e.appendChild(D());let t=document.createElement("tbody"),n=u*y,l=Math.min((u+1)*y,p.length);for(let r=n;r<l;r++)t.appendChild(P(p[r]));return e.appendChild(t),e}function k(){p=[];let e=b.toLowerCase();T.forEach(t=>{(t.device_name.toLowerCase().indexOf(e)>-1||t.circuit_name.toLowerCase().indexOf(e)>-1)&&p.push(t)}),u=0,C()}function C(){let e=N(),t=document.createElement("div");t.classList.add("mt-2","mb-1");let n=p.length/y-2;if(n>1){if(u>0){let a=document.createElement("button");a.classList.add("btn","btn-sm","btn-secondary","me-2"),a.innerHTML="<i class='fa fa-arrow-left'></i>",a.onclick=()=>{u-=1,C()},t.appendChild(a)}let o=document.createElement("span");if(o.classList.add("text-secondary"),o.innerText=u+" / "+n.toFixed(0),t.appendChild(o),u<n-2){let a=document.createElement("button");a.classList.add("btn","btn-sm","btn-secondary","ms-2"),a.innerHTML="<i class='fa fa-arrow-right'></i>",a.onclick=()=>{u+=1,C()},t.appendChild(a)}}let l=document.createElement("div"),r=document.createElement("input");r.id="sdSearch",r.placeholder="Search",r.value=b,r.onkeydown=o=>{o.keyCode==13&&(b=$("#sdSearch").val(),k())};let i=document.createElement("button");i.type="button",i.classList.add("btn","btn-sm"),i.innerHTML="<i class='fa fa-search'></i>",i.onchange=()=>{b=$("#sdSearch").val(),k()},l.appendChild(r),l.appendChild(i);let c=document.getElementById("deviceTable");H(c),c.appendChild(l),c.appendChild(t),c.appendChild(e)}function A(){let e={};T.forEach(n=>{e.hasOwnProperty(n.circuit_id)||(e[n.circuit_id]=1)});let t=0;for(let n in e)t++;return t}function X(){$.get("/local-api/devicesAll",e=>{T=e,p=e,C(),$("#count").text(T.length+" devices"),$("#countCircuit").text(A()+" circuits")})}X();R(["NetworkTreeClients"],e=>{e.event==="NetworkTreeClients"&&e.data.forEach(t=>{let n=document.getElementById("lastSeen_"+t.circuit_id);n!==null&&(n.innerText=I(t.last_seen_nanos));let l=document.getElementById("throughputDown_"+t.circuit_id);l!==null&&(l.innerHTML=f(t.bytes_per_second.down*8,t.plan.down));let r=document.getElementById("throughputUp_"+t.circuit_id);r!==null&&(r.innerHTML=f(t.bytes_per_second.up*8,t.plan.up));let i=document.getElementById("rttDown_"+t.circuit_id);i!==null&&t.median_latency!=null&&(i.innerHTML=h(t.median_latency.down));let c=document.getElementById("rttUp_"+t.circuit_id);c!==null&&t.median_latency!=null&&(c.innerHTML=h(t.median_latency.up));let o=document.getElementById("reXmitDown_"+t.circuit_id);o!==null&&(o.innerHTML=_(t.tcp_retransmits.down));let a=document.getElementById("reXmitUp_"+t.circuit_id);a!==null&&(a.innerHTML=_(t.tcp_retransmits.up))})});})();
//# sourceMappingURL=shaped-devices.js.map
