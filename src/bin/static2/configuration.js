(()=>{var x=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var y=x((exports,module)=>{var nics=null,lqosd_config=null,shaped_devices=null,network_json=null,bindings=[{field:"bindVersion",path:".version",data:"string",editable:!1},{field:"bindPath",path:".lqos_directory",data:"string",editable:!0,required:!0},{field:"bindNodeId",path:".node_id",data:"string",editable:!0,required:!0},{field:"bindNodeName",path:".node_name",data:"string",editable:!0,required:!0},{field:"bindPacketCaptureTime",path:".packet_capture_time",data:"integer",editable:!0,min:1,max:300},{field:"bindQueueCheckPeriodMs",path:".queue_check_period_ms",data:"integer",editable:!0,min:100,max:1e5},{field:"bindSendAnonymous",path:".usage_stats.send_anonymous",data:"bool",editable:!0},{field:"bindAnonymousServer",path:".usage_stats.anonymous_server",data:"string",editable:!0,required:!0},{field:"bindStopIrqBalance",path:".tuning.stop_irq_balance",data:"bool",editable:!0},{field:"bindNetdevBudgetUs",path:".tuning.netdev_budget_usecs",data:"integer",editable:!0},{field:"bindNetdevBudgetPackets",path:".tuning.netdev_budget_packets",data:"integer",editable:!0},{field:"bindRxUs",path:".tuning.rx_usecs",data:"integer",editable:!0},{field:"bindTxUs",path:".tuning.tx_usecs",data:"integer",editable:!0},{field:"bindDisableRxVlan",path:".tuning.disable_rxvlan",data:"bool",editable:!0},{field:"bindDisableTxVlan",path:".tuning.disable_txvlan",data:"bool",editable:!0},{field:"bindDisableOffload",path:".tuning.disable_offload",data:"array_of_strings",editable:!0},{conditional:!0,condition:"if_exists",path:".bridge",showDiv:"bridgeMode",hideDiv:"OnAStickMode"},{field:"bindUseXdpBridge",path:".bridge.use_xdp_bridge",data:"bool",editable:!0},{field:"bindBridgeToInternet",path:".bridge.to_internet",data:"interface",editable:!0},{field:"bindBridgeToNetwork",path:".bridge.to_network",data:"interface",editable:!0},{end_conditional:!0},{conditional:!0,condition:"if_exists",path:".single_interface",showDiv:"OnAStickMode",hideDiv:"bridgeMode"},{field:"bindSingleInterfaceNic",path:".single_interface.interface",data:"interface",editable:!0},{field:"bindSingleInterfaceInternetVlan",path:".single_interface.internet_vlan",data:"integer",editable:!0},{field:"bindSingleInterfaceNetworklan",path:".single_interface.network_vlan",data:"integer",editable:!0},{end_conditional:!0},{field:"bindSqm",path:".queues.default_sqm",data:"select-premade",editable:!0},{field:"bindMonitorMode",path:".queues.monitor_only",data:"bool",editable:!0},{field:"bindUplinkMbps",path:".queues.uplink_bandwidth_mbps",data:"integer",editable:!0},{field:"bindDownlinkMbps",path:".queues.downlink_bandwidth_mbps",data:"integer",editable:!0},{field:"bindGeneratedDownlinkMbps",path:".queues.generated_pn_download_mbps",data:"integer",editable:!0},{field:"bindGeneratedUplinkMbps",path:".queues.generated_pn_upload_mbps",data:"integer",editable:!0},{field:"bindDryRun",path:".queues.dry_run",data:"bool",editable:!0},{field:"bindSudo",path:".queues.sudo",data:"bool",editable:!0},{field:"bindBinpack",path:".queues.use_binpacking",data:"bool",editable:!0},{field:"bindQueuesAvailableOverride",path:".queues.override_available_queues",data:"integer",editable:!0},{field:"bindEnableLTS",path:".long_term_stats.gather_stats",data:"bool",editable:!0},{field:"bindLtsCollation",path:".long_term_stats.collation_period_seconds",data:"integer",editable:!0},{field:"bindLtsLicense",path:".long_term_stats.license_key",data:"string",editable:!0},{field:"bindLtsUispInterval",path:".long_term_stats.uisp_reporting_interval_seconds",data:"integer",editable:!0},{field:"bindIgnoreRanges",path:".ip_ranges.ignore_subnets",data:"ip_array",editable:!0},{field:"bindAllowRanges",path:".ip_ranges.allow_subnets",data:"ip_array",editable:!0},{field:"bindFlowsTimeout",path:".flows.flow_timeout_seconds",data:"integer",editable:!0},{field:"bindEnableNetflow",path:".flows.netflow_enabled",data:"bool",editable:!0},{field:"bindFlowsPort",path:".flows.netflow_port",data:"integer",editable:!0},{field:"bindFlowsTarget",path:".flows.netflow_ip",data:"string",editable:!0},{field:"bindFlowsVersion",path:".flows.netflow_ip",data:"select-premade",editable:!0},{field:"bindCircuitNameAsAddress",path:".integration_common.circuit_name_as_address",data:"bool",editable:!0},{field:"bindOverwriteNetJson",path:".integration_common.always_overwrite_network_json",data:"bool",editable:!0},{field:"bindQueueRefreshInterval",path:".integration_common.queue_refresh_interval_mins",data:"integer",editable:!0},{field:"bindSplynxEnable",path:".spylnx_integration.enable_spylnx",data:"bool",editable:!0},{field:"bindSplynxApiKey",path:".spylnx_integration.api_key",data:"string",editable:!0},{field:"bindSplynxApiSecret",path:".spylnx_integration.api_secret",data:"string",editable:!0},{field:"bindSplynxApiUrl",path:".spylnx_integration.url",data:"string",editable:!0},{field:"bindUispEnable",path:".uisp_integration.enable_uisp",data:"bool",editable:!0},{field:"bindUispToken",path:".uisp_integration.token",data:"string",editable:!0},{field:"bindUispUrl",path:".uisp_integration.url",data:"string",editable:!0},{field:"bindUispSite",path:".uisp_integration.site",data:"string",editable:!0},{field:"bindUispStrategy",path:".uisp_integration.strategy",data:"select-premade",editable:!0},{field:"bindUispSuspended",path:".uisp_integration.suspended_strategy",data:"select-premade",editable:!0},{field:"bindUispAirmaxCapacity",path:".uisp_integration.airmax_capacity",data:"float",editable:!0},{field:"bindUispLtuCapacity",path:".uisp_integration.ltu_capacity",data:"float",editable:!0},{field:"bindUispIpv6Mikrotik",path:".uisp_integration.ipv6_with_mikrotik",data:"bool",editable:!0},{field:"bindUispOverheadFactor",path:".uisp_integration.bandwidth_overhead_factor",data:"float",editable:!0},{field:"bindUispCommitMultiplier",path:".uisp_integration.commit_bandwidth_multiplier",data:"float",editable:!0},{field:"bindUispExcludeSites",path:".uisp_integration.exclude_sites",data:"array_of_strings",editable:!0},{field:"bindUispExceptionCpes",path:".uisp_integration.exception_cpes",data:"array_of_strings",editable:!0},{field:"bindUispUsePtmpAsParent",path:".uisp_integration.use_ptmp_as_parent",data:"bool",editable:!0},{field:"bindUispIgnoreCalculatedCapacity",path:".uisp_integration.ignore_calculated_capacity",data:"bool",editable:!0},{field:"bindPowercodeEnable",path:".powercode_integration.enable_powercode",data:"bool",editable:!0},{field:"bindPowercodeKey",path:".powercode_integration.powercode_api_key",data:"string",editable:!0},{field:"bindPowercodeUrl",path:".powercode_integration.powercode_api_url",data:"string",editable:!0},{field:"bindSonarEnable",path:".sonar_integration.enable_sonar",data:"bool",editable:!0},{field:"bindSonarApiKey",path:".sonar_integration.sonar_api_key",data:"string",editable:!0},{field:"bindSonarApiUrl",path:".sonar_integration.sonar_api_url",data:"string",editable:!0},{field:"bindSonarSnmp",path:".sonar_integration.snmp_community",data:"string",editable:!0},{field:"bindSonarAirmax",path:".sonar_integration.airmax_model_ids",data:"array_of_strings",editable:!0},{field:"bindSonarLtu",path:".sonar_integration.ltu_model_ids",data:"array_of_strings",editable:!0},{field:"bindSonarActive",path:".sonar_integration.active_status_ids",data:"array_of_strings",editable:!0},{field:"bindInfluxEnable",path:".influxdb.enable_influxdb",data:"bool",editable:!0},{field:"bindInfluxUrl",path:".influxdb.url",data:"string",editable:!0},{field:"bindInfluxOrg",path:".influxdb.org",data:"string",editable:!0},{field:"bindInfluxBucket",path:".influxdb.bucket",data:"string",editable:!0},{field:"bindInfluxToken",path:".influxdb.token",data:"string",editable:!0}];function doBindings(){let active=!0;for(var i=0;i<bindings.length;++i){let entry=bindings[i];if(entry.conditional!=null){if(console.log("Conditional encountered"),entry.condition==="if_exists"){let val="lqosd_config"+entry.path;eval(val)!=null?(console.log("Conditional fired"),active=!0,entry.showDiv!=null&&$("#"+entry.showDiv).show(),entry.hideDiv!=null&&$("#"+entry.hideDiv).hide()):(console.log("Conditional did not fire"),active=!1)}}else if(entry.end_conditional!=null)console.log("Conditional ended"),active=!0;else{if(!active){console.log("Skipping "+entry.path);continue}let value_location="lqosd_config"+entry.path,value=eval(value_location),controlId="#"+entry.field;if(entry.data==="bool")$(controlId).prop("checked",value);else if(entry.data==="selector-premade")$(controlId+" select").val(value);else if(entry.data==="array_of_strings"){let expanded="",length=eval("lqosd_config"+entry.path+".length");for(let j=0;j<length;j++){let v=eval("lqosd_config"+entry.path+"["+j+"]");expanded+=v+" "}expanded=expanded.trimEnd(),$(controlId).val(expanded)}else if(entry.data==="ip_array"){let expanded="",length=eval("lqosd_config"+entry.path+".length");for(let j=0;j<length;j++){let v=eval("lqosd_config"+entry.path+"["+j+"]");expanded+=v+"\n"}expanded=expanded.trimEnd(),$(controlId).val(expanded)}else entry.data==="interface"?(console.log("NIC: "+entry.field),fillNicList(entry.field,value)):$(controlId).val(value);$(controlId).prop("readonly",!entry.editable)}}}function setBridgeMode(){$("#bridgeMode").show(),$("#OnAStickMode").hide(),lqosd_config.single_interface=null,lqosd_config.bridge={use_xdp_bridge:!0,to_internet:"",to_network:""},$("#bindUseXdpBridge").prop("checked",!0),fillNicList("bindBridgeToInternet",nics[0][0]),fillNicList("bindBridgeToNetwork",nics[0][0])}function setStickMode(){$("#bridgeMode").hide(),$("#OnAStickMode").show(),lqosd_config.bridge=null,lqosd_config.single_interface={interface:"",internet_vlan:2,network_vlan:3},fillNicList("bindSingleInterfaceNic",nics[0][0]),$("#bindSingleInterfaceInternetVlan").val("2"),$("#bindSingleInterfaceNetworklan").val("3")}function detectChanges(){let changes=[];for(let i=0;i<bindings.length;++i){let entry=bindings[i],controlId=entry.field;if(!(entry.path===".bridge"||entry.path===".single_interface")&&entry.path!=null){let path="lqosd_config"+entry.path,currentValue=$("#"+controlId).val();entry.data==="bool"?currentValue=$("#"+controlId).is(":checked"):entry.data==="array_of_strings"?currentValue=currentValue.replace("\n","").split(" "):entry.data==="ip_array"&&(currentValue=currentValue.split("\n"));try{let storedValue=eval(path);(entry.data==="string"||entry.data==="integer")&&storedValue===null&&currentValue===""&&(currentValue=null),String(currentValue)!==String(storedValue)&&(console.log("Change detected!"),console.log(entry.path," has changed. ",storedValue,"=>",currentValue),changes.push(i))}catch(e){}}}return changes}function validateConfig(){console.log("Starting validator"),$(".invalid").removeClass("invalid");let e=detectChanges();if(e.length===0)return console.log("Nothing changed!"),alert("No configuration changes were made."),{valid:!1,changes:[]};let t=!0,l=[];for(let n=0;n<e.length;n++){let a=bindings[e[n]];if(a.data==="string"){let d=$("#"+a.field).val();a.required!=null&&a.required===!0&&d.length===0&&(t=!1,l.push(a.path+" is required."),$("#"+a.field).addClass("invalid"))}else if(a.data==="integer"||a.data==="float"){let d=$("#"+a.field).val();d=parseInt(d),isNaN(d)?(t=!1,l.push(a.path+" must be an integer number."),$("#"+a.field).addClass("invalid")):(a.min!=null&&d<a.min&&(t=!1,l.push(a.path+" must be between "+a.min+" and "+a.max+"."),$("#"+a.field).addClass("invalid")),a.max!=null&&d>a.max&&(t=!1,l.push(a.path+" must be between "+a.min+" and "+a.max+"."),$("#"+a.field).addClass("invalid")))}}if(!t){let n="";for(let a=0;a<l.length;a++)n+=l[a]+"\n";alert("Validation errors\n"+n)}return console.log("Ending Validator"),{valid:t,changes:e}}function getFinalValue(e){let t="#"+e.field;switch(e.data){case"bool":return $(t).is(":checked");case"string":return $(t).val();case"integer":return parseInt($(t).val());case"float":return parseFloat($(t).val());case"array_of_strings":return $(t).val().split(" ");case"interface":return $(t).val();case"select-premade":return $(t).val();case"ip_array":return $(t).val().split("\n");default:console.log("Not handled: "+e)}}function updateSavedConfig(e){for(let t=0;t<e.length;t++){let l=bindings[e[t]],n=l.path.split(".");n.length===2&&(lqosd_config[n[1]]=getFinalValue(l));let a=lqosd_config;for(let d=1;d<n.length-1;d++)a=a[n[d]],d===n.length-2&&(a[n[d+1]]=getFinalValue(l))}}function saveConfig(){let e=validateConfig();e.valid&&(updateSavedConfig(e.changes),$.ajax({type:"POST",url:"/local-api/updateConfig",contentType:"application/json",data:JSON.stringify(lqosd_config),success:t=>{alert(t==="Ok"?"Configuration saved":"Configuration not saved: "+t)}}))}function iterateNetJson(e,t){let l="<div style='margin-left: "+t*30+"px; margin-top: 4px;'>";for(let[n,a]of Object.entries(e)){l+="<div>",l+="<strong>"+n+"</strong>",t>0&&(l+="  <button class='btn btn-sm btn-outline-secondary' onclick='window.promoteNode(\""+n+"\") '><i class='fa fa-arrow-left'></i> Promote</button>"),l+="  <button class='btn btn-sm btn-outline-secondary' onclick='window.renameNode(\""+n+"\") '><i class='fa fa-pencil'></i> Rename</button>",l+="  <button class='btn btn-sm btn-outline-warning' onclick='window.deleteNode(\""+n+"\") '><i class='fa fa-trash'></i> Delete</button>",l+="<br />",l+="Download: "+a.downloadBandwidthMbps+" Mbps <button type='button' class='btn btn-sm btn-outline-secondary' onclick='window.nodeSpeedChange(\""+n+"\", \"d\")'><i class='fa fa-pencil'></i></button><br />",l+="Upload: "+a.uploadBandwidthMbps+" Mbps <button type='button' class='btn btn-sm btn-outline-secondary' onclick='window.nodeSpeedChange(\""+n+"\", \"u\")'><i class='fa fa-pencil'></i></button><br />";let d=0;for(let r=0;r<shaped_devices.length;r++)shaped_devices[r].parent_node===n&&d++;l+="<em>Associated Devices: "+d+"</em><br />",a.children!=null&&(l+=iterateNetJson(a.children,t+1)),l+="</div>"}return l+="</div>",l}function RenderNetworkJson(){let e="";e+=iterateNetJson(network_json,0),$("#netjson").html(e)}function flattenNetwork(){if(confirm("Are you sure you wish to flatten your network? All topology will be removed, giving a flat network. All Shaped Devices will be reparented to the single node.")){network_json={},RenderNetworkJson();for(let e=0;e<shaped_devices.length;e++)shaped_devices[e].parent_node="";shapedDevices()}}function addNetworkNode(){let e=$("#njsNewNodeName").val(),t=parseInt($("#njsNewNodeDown").val()),l=parseInt($("#njsNewNodeUp").val());e.length>0&&t>1&&l>1&&(network_json[e]={downloadBandwidthMbps:t,uploadBandwidthMbps:l,children:{}}),RenderNetworkJson()}function promoteNode(e){console.log("Promoting ",e);let t=null;function l(n,a){for(let[d,r]of Object.entries(n)){if(console.log(d),d===e){console.log(d);let o=r;delete n[e],t[e]=o}r.children!=null&&(t=n,l(r.children,a+1))}}l(network_json),RenderNetworkJson()}function nodeSpeedChange(e,t){let l=prompt("New download value in Mbps");if(l=parseInt(l),isNaN(l)){alert("That's not an integer!");return}if(l<1){alert("New value must be greater than 1");return}function n(a,d){for(let[r,o]of Object.entries(a)){if(console.log(r),r===e)switch(t){case"d":o.downloadBandwidthMbps=l;break;case"u":o.uploadBandwidthMbps=l;break;default:console.log("Oopsie - unknown direction")}o.children!=null&&n(o.children,d+1)}}n(network_json),RenderNetworkJson()}function deleteNode(e){if(!confirm("Are you sure you want to delete "+e+"? All child nodes will also be deleted."))return;let t=[e],l="";function n(d,r,o){for(let[u,c]of Object.entries(d))u===e&&(c.children!=null&&a(c.children,r+1),l=o,delete d[u]),c.children!=null&&n(c.children,r+1,u)}function a(d,r){for(let[o,u]of Object.entries(d))t.push(o),u.children!=null&&a(u.children,r+1)}if(n(network_json,""),console.log(l),l==null){for(let d=0;d<shaped_devices.length;d++){let r=shaped_devices[d];t.indexOf(r.parent_node)>-1&&(r.parent_node="")}alert("Because there was no obvious parent, you may have to fix some parenting in your Shaped Devices list.")}else for(let d=0;d<shaped_devices.length;d++){let r=shaped_devices[d];t.indexOf(r.parent_node)>-1&&(r.parent_node=l)}RenderNetworkJson(),shapedDevices()}function renameNode(e){let t=prompt("New node name?");function l(n,a){for(let[d,r]of Object.entries(n)){if(console.log(d),d===e){console.log(d);let o=r;delete n[e],n[t]=o}r.children!=null&&l(r.children,a+1)}}l(network_json);for(let n=0;n<shaped_devices.length;n++){let a=shaped_devices[n];a.parent_node===e&&(a.parent_node=t)}RenderNetworkJson(),shapedDevices()}function rowPrefix(e,t){return"sdr_"+e+"_"+t}function makeSheetBox(e,t,l,n=!1){let a="";return n?a="<td style='padding: 0px'><input id='"+rowPrefix(e,t)+'\' type="text" value="'+l+"\" style='font-size: 8pt;'></input></td>":a="<td style='padding: 0px'><input id='"+rowPrefix(e,t)+'\' type="text" value="'+l+'"></input></td>',a}function makeSheetNumberBox(e,t,l){return"<td style='padding: 0px'><input id='"+rowPrefix(e,t)+'\' type="number" value="'+l+"\" style='width: 100px; font-size: 8pt;'></input></td>"}function separatedIpArray(e,t,l){let n="<td style='padding: 0px'>",a="";for(i=0;i<l.length;i++)a+=l[i][0],a+="/",a+=l[i][1],a+=", ";return a.length>0&&(a=a.substring(0,a.length-2)),n+="<input id='"+rowPrefix(e,t)+"' type='text' style='font-size: 8pt; width: 100px;' value='"+a+"'></input>",n+="</td>",n}function nodeDropDown(e,t,l){let n="<td style='padding: 0px'>";n+="<select id='"+rowPrefix(e,t)+"' style='font-size: 8pt; width: 150px;'>";function a(d,r){let o="";for(let[u,c]of Object.entries(d)){o+="<option value='"+u+"'",u===l&&(o+=" selected"),o+=">";for(let f=0;f<r;f++)o+="-";o+=u,o+="</option>",c.children!=null&&(o+=a(c.children,r+1))}return o}return n+=a(network_json,0),n+="</select>",n+="</td>",n}function validNodeList(){let e=[];function t(l,n){for(let[a,d]of Object.entries(l))e.push(a),d.children!=null&&t(d.children,n+1)}return t(network_json,0),e}function newSdRow(){shaped_devices.unshift({circuit_id:"new_circuit",circuit_name:"new circuit",device_id:"new_device",device_name:"new device",mac:"",ipv4:"",ipv6:"",download_min_mbps:100,upload_min_mbps:100,download_max_mbps:100,upload_max_mbps:100,comment:""}),shapedDevices()}function deleteSdRow(e){shaped_devices.splice(e,1),shapedDevices()}function checkIpv4(e){let t=/^(\d{1,3}\.){3}\d{1,3}$/;if(e.indexOf("/")===-1)return t.test(e);{let l=e.split("/");return t.test(l[0])}}function checkIpv6(e){let t=/^([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}$/;if(e.indexOf("/")===-1)return t.test(e);{let l=e.split("/");return t.test(l[0])}}function checkIpv4Duplicate(e,t){e=e.trim();for(let l=0;l<shaped_devices.length;l++)if(l!==t){let n=shaped_devices[l];for(let a=0;a<n.ipv4.length;a++){let d="";if(e.indexOf("/")>0?d=n.ipv4[a][0]+"/"+n.ipv4[a][1]:d=n.ipv4[a][0],d===e)return t}}return-1}function checkIpv6Duplicate(e,t){e=e.trim();for(let l=0;l<shaped_devices.length;l++)if(l!==t){let n=shaped_devices[l];for(let a=0;a<n.ipv6.length;a++){let d="";if(e.indexOf("/")>0?d=n.ipv6[a][0]+"/"+n.ipv6[a][1]:d=n.ipv6[a][0],d===e)return t}}return-1}function validateSd(){let e=!0,t=[];$(".invalid").removeClass("invalid");let l=validNodeList();for(let n=0;n<shaped_devices.length;n++){let a="#"+rowPrefix(n,"circuit_id");$(a).val().length===0&&(e=!1,t.push("Circuits must have a Circuit ID"),$(a).addClass("invalid")),a="#"+rowPrefix(n,"circuit_name"),$(a).val().length===0&&(e=!1,t.push("Circuits must have a Circuit Name"),$(a).addClass("invalid")),a="#"+rowPrefix(n,"device_id");let o=$(a).val();o.length===0&&(e=!1,t.push("Circuits must have a Device ID"),$(a).addClass("invalid"));for(let s=0;s<shaped_devices.length;s++)n!==s&&shaped_devices[s].device_id===o&&(e=!1,t.push("Devices with duplicate ID ["+o+"] detected"),$(a).addClass("invalid"),$("#"+rowPrefix(s,"device_id")).addClass("invalid"));a="#"+rowPrefix(n,"device_name"),$(a).val().length===0&&(e=!1,t.push("Circuits must have a Device Name"),$(a).addClass("invalid")),a="#"+rowPrefix(n,"parent_node");let c=$(a).val();c==null&&(c=""),l.length===0?c.length>0&&(e=!1,t.push("You have a flat network, so you can't specify a parent node."),$(a).addClass("invalid")):l.indexOf(c)===-1&&(e=!1,t.push("Parent node: "+c+" does not exist"),$(a).addClass("invalid")),a="#"+rowPrefix(n,"ipv4");let f=$(a).val();if(f.length>0)if(f.indexOf(",")!==-1){let s=f.replace(" ","").split(",");for(let p=0;p<s.length;p++){checkIpv4(s[p].trim())||(e=!1,t.push(s[p]+"is not a valid IPv4 address"),$(a).addClass("invalid"));let b=checkIpv4Duplicate(s[p],n);b>0&&b!==n&&(e=!1,t.push(s[p]+" is a duplicate IP"),$(a).addClass("invalid"),$("#"+rowPrefix(b,"ipv4")).addClass("invalid"))}}else{checkIpv4(f)||(e=!1,t.push(f+"is not a valid IPv4 address"),$(a).addClass("invalid"));let s=checkIpv4Duplicate(f,n);s>0&&(e=!1,t.push(f+" is a duplicate IP"),$(a).addClass("invalid"),$("#"+rowPrefix(s,"ipv4")).addClass("invalid"))}a="#"+rowPrefix(n,"ipv6");let h=$(a).val();if(h.length>0)if(h.indexOf(",")!==-1){let s=h.replace(" ","").split(",");for(let p=0;p<s.length;p++){checkIpv6(s[p].trim())||(e=!1,t.push(s[p]+"is not a valid IPv6 address"),$(a).addClass("invalid"));let b=checkIpv6Duplicate(s[p],n);b>0&&b!==n&&(e=!1,t.push(s[p]+" is a duplicate IP"),$(a).addClass("invalid"),$("#"+rowPrefix(b,"ipv6")).addClass("invalid"))}}else{checkIpv6(h)||(e=!1,t.push(h+"is not a valid IPv6 address"),$(a).addClass("invalid"));let s=checkIpv6Duplicate(h,n);s>0&&s!==n&&(e=!1,t.push(h+" is a duplicate IP"),$(a).addClass("invalid"),$("#"+rowPrefix(s,"ipv6")).addClass("invalid"))}f.length===0&&h.length===0&&(e=!1,t.push("You must specify either an IPv4 or IPv6 (or both) address"),$(a).addClass("invalid"),$("#"+rowPrefix(n,"ipv4")).addClass("invalid")),a="#"+rowPrefix(n,"download_min_mbps");let g=$(a).val();g=parseInt(g),isNaN(g)?(e=!1,t.push("Download min is not a valid number"),$(a).addClass("invalid")):g<1&&(e=!1,t.push("Download min must be 1 or more"),$(a).addClass("invalid")),a="#"+rowPrefix(n,"upload_min_mbps");let _=$(a).val();_=parseInt(_),isNaN(_)?(e=!1,t.push("Upload min is not a valid number"),$(a).addClass("invalid")):_<1&&(e=!1,t.push("Upload min must be 1 or more"),$(a).addClass("invalid")),a="#"+rowPrefix(n,"download_max_mbps");let m=$(a).val();_=parseInt(m),isNaN(m)?(e=!1,t.push("Download Max is not a valid number"),$(a).addClass("invalid")):m<1&&(e=!1,t.push("Download Max must be 1 or more"),$(a).addClass("invalid")),a="#"+rowPrefix(n,"upload_max_mbps");let w=$(a).val();_=parseInt(w),isNaN(w)?(e=!1,t.push("Upload Max is not a valid number"),$(a).addClass("invalid")):w<1&&(e=!1,t.push("Upload Max must be 1 or more"),$(a).addClass("invalid"))}if(!e){let n="Invalid ShapedDevices Entries:\n";for(let a=0;a<t.length;a++)n+=t[a]+"\n";alert(n)}return{valid:e,errors:t}}function ipAddressesToTuple(e){if(e.length===0)return[];let t=e.replace(" ","").split(",");for(let l=0;l<t.length;l++){let a=t[l].trim().split("/");t[l]=[a[0],parseInt(a[1])]}return t}function saveNetAndDevices(){if(!validateSd().valid){alert("Validation errors in ShapedDevices. Not Saving");return}for(let l=0;l<shaped_devices.length;l++){let n=shaped_devices[l];n.circuit_id=$("#"+rowPrefix(l,"circuit_id")).val(),n.circuit_name=$("#"+rowPrefix(l,"circuit_name")).val(),n.device_id=$("#"+rowPrefix(l,"device_id")).val(),n.device_name=$("#"+rowPrefix(l,"device_name")).val(),n.parent_node=$("#"+rowPrefix(l,"parent_node")).val(),n.mac=$("#"+rowPrefix(l,"mac")).val(),n.ipv4=ipAddressesToTuple($("#"+rowPrefix(l,"ipv4")).val()),n.ipv6=ipAddressesToTuple($("#"+rowPrefix(l,"ipv6")).val()),n.download_min_mbps=parseInt($("#"+rowPrefix(l,"download_min_mbps")).val()),n.upload_min_mbps=parseInt($("#"+rowPrefix(l,"upload_min_mbps")).val()),n.download_max_mbps=parseInt($("#"+rowPrefix(l,"download_max_mbps")).val()),n.upload_max_mbps=parseInt($("#"+rowPrefix(l,"upload_max_mbps")).val()),n.comment=$("#"+rowPrefix(l,"comment")).val()}console.log(network_json);let t={shaped_devices,network_json};$.ajax({type:"POST",url:"/local-api/updateNetworkAndDevices",contentType:"application/json",data:JSON.stringify(t),success:l=>{alert(l==="Ok"?"Configuration saved":"Configuration not saved: "+l)}})}function shapedDevices(){let e="<table style='height: 500px; overflow: scroll; border-collapse: collapse; width: 100%; padding: 0px'>";e+="<thead style='position: sticky; top: 0; height: 50px; background: navy; color: white;'>",e+="<tr style='font-size: 9pt;'><th>Circuit ID</th><th>Circuit Name</th><th>Device ID</th><th>Device Name</th><th>Parent Node</th><th>MAC</th><th>IPv4</th><th>IPv6</th><th>Download Min</th><th>Upload Min</th><th>Download Max</th><th>Upload Max</th><th>Comment</th><th></th></th></tr>",e+="</thead>";for(var t=0;t<shaped_devices.length;t++){let l=shaped_devices[t];e+="<tr>",e+=makeSheetBox(t,"circuit_id",l.circuit_id,!0),e+=makeSheetBox(t,"circuit_name",l.circuit_name,!0),e+=makeSheetBox(t,"device_id",l.device_id,!0),e+=makeSheetBox(t,"device_name",l.device_name,!0),e+=nodeDropDown(t,"parent_node",l.parent_node,!0),e+=makeSheetBox(t,"mac",l.mac,!0),e+=separatedIpArray(t,"ipv4",l.ipv4),e+=separatedIpArray(t,"ipv6",l.ipv6),e+=makeSheetNumberBox(t,"download_min_mbps",l.download_min_mbps),e+=makeSheetNumberBox(t,"upload_min_mbps",l.upload_min_mbps),e+=makeSheetNumberBox(t,"download_max_mbps",l.download_max_mbps),e+=makeSheetNumberBox(t,"upload_max_mbps",l.upload_max_mbps),e+=makeSheetBox(t,"comment",l.comment,!0),e+="<td><button class='btn btn-sm btn-secondary' type='button' onclick='window.deleteSdRow("+t+")'><i class='fa fa-trash'></i></button></td>",e+="</tr>"}e+="</tbody></table>",$("#shapedDeviceTable").html(e)}function userManager(){$("#userManager").html("<p>For now, please use <em>bin/lqusers</em> to manage users.</p>")}function fillNicList(e,t){let l=$("#"+e),n="";for(i=0;i<nics.length;i++)n+='<option value="',n+=nics[i][0]+'"',nics[i][0]===t&&(n+=" selected"),n+=">"+nics[i][0]+" - "+nics[i][1]+" - "+nics[i][2]+"</option>";l.html(n)}function buildNICList(e,t,l=!1){let n="<select id='"+e+"'";for(l&&(n+=" disabled='true' "),n+=">",i=0;i<nics.length;i++)n+='<option value="',n+=nics[i][0]+'"',nics[i][0]==t&&(n+=" selected"),n+=">"+nics[i][0]+" - "+nics[i][1]+" - "+nics[i][2]+"</option>";return n+="</select>",n}function display(){let e=window.localStorage.getItem("colorPreference");e==null&&(window.localStorage.setItem("colorPreference",0),e=0),$("#colorMode option[id='"+e+"']").attr("selected",!0);let t=window.localStorage.getItem("redact");t==null&&(window.localStorage.setItem("redact",!1),t=!1),t=="false"&&(t=!1),$("#redact").prop("checked",t),$("#applyDisplay").on("click",()=>{let l=$("#colorMode").find("option:selected").attr("id");window.localStorage.setItem("colorPreference",l);let n=$("#redact").prop("checked");window.localStorage.setItem("redact",n)})}function start(){$("#btnFlattenNetwork").on("click",flattenNetwork),$("#btnAddNetworkNode").on("click",addNetworkNode),window.setBridgeMode=setBridgeMode,window.setStickMode=setStickMode,window.newSdRow=newSdRow,window.promoteNode=promoteNode,window.renameNode=renameNode,window.deleteNode=deleteNode,window.nodeSpeedChange=nodeSpeedChange,window.deleteSdRow=deleteSdRow,display(),$.get("/local-api/adminCheck",e=>{e?($("#btnSaveIspConfig").on("click",t=>{saveConfig()}),$("#btnSaveNetDevices").on("click",t=>{saveNetAndDevices()})):($("#controls").html("<p class='alert alert-danger' role='alert'>You have to be an administrative user to change configuration."),$("#userManager").html("<p class='alert alert-danger' role='alert'>Only administrators can see/change user information.")),$.get("/local-api/getConfig",t=>{lqosd_config=t,console.log("Bindings Done"),$.get("/local-api/listNics",l=>{nics=l,console.log(lqosd_config),doBindings(),e&&userManager(),$.get("/local-api/networkJson",n=>{network_json=n,$.get("/local-api/allShapedDevices",a=>{shaped_devices=a,shapedDevices(a),RenderNetworkJson()})})})})})}$(document).ready(start)});y();})();
//# sourceMappingURL=configuration.js.map
