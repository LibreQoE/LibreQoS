(()=>{function x(e,l=2){return e>1e12?(e/1e12).toFixed(l)+"T":e>1e9?(e/1e9).toFixed(l)+"G":e>1e6?(e/1e6).toFixed(l)+"M":e>1e3?(e/1e3).toFixed(l)+"K":e}function E(e,l=2){return e===0?"-":e>6e10?(e/6e10).toFixed(l)+"m":e>1e9?(e/1e9).toFixed(l)+"s":e>1e6?(e/1e6).toFixed(l)+"ms":e>1e3?(e/1e3).toFixed(l)+"\xB5s":e+"ns"}function w(e,l){let n=0,a=0,r=0;return e<l/2?(n=255,a=Math.floor(255*e/(l/2))):(n=Math.floor(255*(l-e)/(l/2)),a=255),"rgb(".concat(n,", ").concat(a,", ").concat(r,")")}function p(e,l){let n=l*1e3*1e3,a=0;n>0&&(a=e/n*100);let t="<span class='muted' style='color: "+w(100-a,100)+"'>\u25A0</span>";return t+="<span>"+x(e,1)+"bps</span>",t}function s(e){if(e==null||e.nanoseconds===0)return"-";let l=200,n=0;l>0&&(n=e/l*100);let r="<span class='muted' style='color: "+w(100-n,100)+"'>\u25A0</span>";return r+="<span>"+parseFloat(e).toFixed(0)+"ms</span>",r}function h(e){let l=Math.min(100,e)/100;return"<span class='muted' style='color: "+L([0,255,0],[255,0,0],l)+"'>\u25A0</span>"+e+"</span>"}function T(e){let l=Math.min(100,e)/100,a="<span class='muted' class='retransmits' style='color: "+L([128,128,0],[255,255,255],l)+"'>";return a+=e,a+="</span>",a}function L(e,l,n){var a=Math.round(e[0]+(l[0]-e[0])*n),r=Math.round(e[1]+(l[1]-e[1])*n),t=Math.round(e[2]+(l[2]-e[2])*n);return"rgb(".concat(a,", ").concat(r,", ").concat(t,")")}function i(e,l=0,n="",a=""){let r=document.createElement("th");return r.classList.add("text-center"),a!==""&&(r.id=a),l>0&&(r.colSpan=l),n!==""?(r.setAttribute("data-bs-toggle","tooltip"),r.setAttribute("data-bs-placement","top"),r.setAttribute("data-bs-html","true"),r.setAttribute("title",n),r.innerHTML=e+" <i class='fas fa-info-circle'></i>"):r.innerText=e,r}function f(e,l=!1){let n=document.createElement("td");return l&&n.classList.add("redactable"),n.innerText=e,n}function C(e){let l=document.createElement("td");return l.innerHTML=e,l}function b(e,l=0){for(;e.children.length>l;)e.removeChild(e.lastChild)}function M(){let e=document.createElement("thead");return e.appendChild(i("Circuit")),e.appendChild(i("Device")),e.appendChild(i("Plan (Mbps)")),e.appendChild(i("Parent")),e.appendChild(i("IP")),e.appendChild(i("Last Seen")),e.appendChild(i("Throughput",2)),e.appendChild(i("RTT",2)),e.appendChild(i("Re-Xmit",2)),e}function y(e){let l=3e11,n="-";return e>l?n="> 5 Minutes ago":n=E(e,0)+" ago",n}var u=null;function B(){return window.location.protocl==="https"?"wss://":"ws://"}function I(e,l){u&&u.close(),u=new WebSocket(B()+window.location.host+"/websocket/ws"),u.onopen=()=>{for(let n=0;n<e.length;n++)u.send('{ "channel" : "'+e[n]+'"}')},u.onclose=()=>{u=null},u.onerror=n=>{u=null},u.onmessage=function(n){let a=JSON.parse(n.data);l(a)}}var c=null,_=0,g=1,k=!1;function R(){$.get("/local-api/networkTree",e=>{c=e;let l=document.createElement("table");l.classList.add("table","table-striped","table-bordered");let n=document.createElement("thead");n.appendChild(i("Name")),n.appendChild(i("Limit")),n.appendChild(i("\u2B07\uFE0F")),n.appendChild(i("\u2B06\uFE0F")),n.appendChild(i("RTT",2,"<h5>TCP Round-Trip Time</h5><p>Current median TCP round-trip time. Time taken for a full send-acknowledge round trip. Low numbers generally equate to a smoother user experience.</p>","tts_retransmits")),n.appendChild(i("Retr",2,"<h5>TCP Retransmits</h5><p>Number of TCP retransmits in the last second.</p>","tts_retransmits")),n.appendChild(i("Marks",2,"<h5>Cake Marks</h5><p>Number of times the Cake traffic manager has applied ECN marks to avoid congestion.</p>","tts_marks")),n.appendChild(i("Drops",2,"<h5>Cake Drops</h5><p>Number of times the Cake traffic manager has dropped packets to avoid congestion.</p>","tts_drops")),l.appendChild(n);let a=document.createElement("tbody");for(let t=0;t<c.length;t++){let d=c[t][0],o=c[t][1];if(d===_&&S(o),o.immediate_parent!==null&&o.immediate_parent===_){let m=D(t);a.appendChild(m),g>1&&N(t,a,1)}}l.appendChild(a);let r=document.getElementById("tree");b(r),r.appendChild(l),k||(I(["NetworkTree","NetworkTreeClients"],U),k=!0)})}function S(e){$("#nodeName").text(e.name);let l="";e.max_throughput[0]===0?l="Unlimited":l=x(e.max_throughput[0]*1e3*1e3,0),l+=" / ",e.max_throughput[1]===0?l+="Unlimited":l+=x(e.max_throughput[1]*1e3*1e3,0),$("#parentLimits").text(l),$("#parentTpD").html(p(e.current_throughput[0]*8,e.max_throughput[0])),$("#parentTpU").html(p(e.current_throughput[1]*8,e.max_throughput[1])),$("#parentRttD").html(s(e.rtts[0])),$("#parentRttU").html(s(e.rtts[1]))}function N(e,l,n){for(let a=0;a<c.length;a++){let r=c[a][1];if(r.immediate_parent!==null&&r.immediate_parent===c[e][0]){let t=D(a,n);l.appendChild(t),n<g-1&&N(a,l,n+1)}}}function D(e,l=0){let n=c[e][1],a=c[e][0],r=document.createElement("tr");r.classList.add("small");let t=document.createElement("td"),d="";l>0&&(d+="\u2514");for(let m=1;m<l;m++)d+="\u2500";l>0&&(d+=" "),d+="<a href='/tree.html?parent="+a+"' class='redactable'>",d+=n.name,d+="</a>",n.type!==null&&(d+=" ("+n.type+")"),t.innerHTML=d,t.classList.add("small"),r.appendChild(t),t=document.createElement("td"),t.id="limit-"+a,t.classList.add("small");let o="";return n.max_throughput[0]===0?o="Unlimited":o=x(n.max_throughput[0]*1e3*1e3,0),o+=" / ",n.max_throughput[1]===0?o+="Unlimited":o+=x(n.max_throughput[0]*1e3*1e3,0),t.textContent=o,r.appendChild(t),t=document.createElement("td"),t.id="down-"+a,t.classList.add("small"),t.innerHTML=p(n.current_throughput[0]*8,n.max_throughput[0]),r.appendChild(t),t=document.createElement("td"),t.id="up-"+a,t.classList.add("small"),t.innerHTML=p(n.current_throughput[1]*8,n.max_throughput[1]),r.appendChild(t),t=document.createElement("td"),t.id="rtt-down-"+a,t.innerHTML=s(n.rtts[0]),r.appendChild(t),t=document.createElement("td"),t.id="rtt-up-"+a,t.innerHTML=s(n.rtts[1]),r.appendChild(t),t=document.createElement("td"),t.id="re-xmit-down-"+a,n.current_retransmits[0]!==void 0?t.innerHTML=h(n.current_retransmits[0]):t.textContent="-",r.appendChild(t),t=document.createElement("td"),t.id="re-xmit-up-"+a,n.current_retransmits[1]!==void 0?t.innerHTML=h(n.current_retransmits[1]):t.textContent="-",r.appendChild(t),t=document.createElement("td"),t.id="ecn-down-"+a,n.current_marks[0]!==void 0?t.innerHTML=T(n.current_marks[0]):t.textContent="-",r.appendChild(t),t=document.createElement("td"),t.id="ecn-up-"+a,n.current_marks[1]!==void 0?t.innerHTML=T(n.current_marks[1]):t.textContent="-",r.appendChild(t),t=document.createElement("td"),t.id="drops-down-"+a,n.current_drops[0]!==void 0?t.innerHTML=T(n.current_drops[0]):t.textContent="-",r.appendChild(t),t=document.createElement("td"),t.id="drops-up-"+a,n.current_drops[1]!==void 0?t.innerHTML=T(n.current_drops[1]):t.textContent="-",r.appendChild(t),r}function P(e){e.data.forEach(l=>{let n=l[0],a=l[1];n===_&&S(a);let r=document.getElementById("down-"+n);r!==null&&(r.innerHTML=p(a.current_throughput[0]*8,a.max_throughput[0])),r=document.getElementById("up-"+n),r!==null&&(r.innerHTML=p(a.current_throughput[1]*8,a.max_throughput[1])),r=document.getElementById("rtt-down-"+n),r!==null&&(r.innerHTML=s(a.rtts[0])),r=document.getElementById("rtt-up-"+n),r!==null&&(r.innerHTML=s(a.rtts[1])),r=document.getElementById("re-xmit-down-"+n),r!==null&&(a.current_retransmits[0]!==void 0?r.innerHTML=h(a.current_retransmits[0]):r.textContent="-"),r=document.getElementById("re-xmit-up-"+n),r!==null&&(a.current_retransmits[1]!==void 0?r.innerHTML=h(a.current_retransmits[1]):r.textContent="-"),r=document.getElementById("ecn-down-"+n),r!==null&&(a.current_marks[0]!==void 0?r.textContent=a.current_marks[0]:r.textContent="-"),r=document.getElementById("ecn-up-"+n),r!==null&&(a.current_marks[1]!==void 0?r.textContent=a.current_marks[1]:r.textContent="-"),r=document.getElementById("drops-down-"+n),r!==null&&(a.current_drops[0]!==void 0?r.textContent=a.current_drops[0]:r.textContent="-"),r=document.getElementById("drops-up-"+n),r!==null&&(a.current_drops[1]!==void 0?r.textContent=a.current_drops[1]:r.textContent="-")})}function F(e){let l=c[_][1].name,n=document.getElementById("clients"),a=document.createElement("table");a.classList.add("table","table-striped","table-bordered"),a.appendChild(M());let r=document.createElement("tbody");b(n),e.data.forEach(t=>{if(t.parent_node===l){let d=document.createElement("tr"),o=document.createElement("td"),m=document.createElement("a");m.href="/circuit.html?id="+t.circuit_id,m.innerText=t.circuit_name,o.appendChild(m),d.appendChild(o),d.appendChild(f(t.device_name)),d.appendChild(f(t.plan.down+" / "+t.plan.up)),d.appendChild(f(t.parent_node)),d.appendChild(f(t.ip)),d.appendChild(f(y(t.last_seen_nanos))),d.appendChild(C(p(t.bytes_per_second.down*8,t.plan.down))),d.appendChild(C(p(t.bytes_per_second.up*8,t.plan.up))),t.median_latency!==null?(d.appendChild(C(s(t.median_latency.down))),d.appendChild(C(s(t.median_latency.up)))):(d.appendChild(f("-")),d.appendChild(f("-"))),d.appendChild(C(h(t.tcp_retransmits.down))),d.appendChild(C(h(t.tcp_retransmits.up))),r.appendChild(d)}}),a.appendChild(r),n.appendChild(a)}function U(e){e.event==="NetworkTree"?P(e):e.event==="NetworkTreeClients"&&F(e)}var H=new Proxy(new URLSearchParams(window.location.search),{get:(e,l)=>e.get(l)});H.parent!==null?_=parseInt(H.parent):_=0;localStorage.getItem("treeMaxDepth")!==null&&(g=parseInt(localStorage.getItem("treeMaxDepth")),$("#maxDepth").val(g));$("#maxDepth").on("change",function(){g=parseInt($(this).val()),localStorage.setItem("treeMaxDepth",g),R()});R();})();
//# sourceMappingURL=tree.js.map
