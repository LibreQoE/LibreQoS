(()=>{function X(e,t=2){return e>1e12?(e/1e12).toFixed(t)+"T":e>1e9?(e/1e9).toFixed(t)+"G":e>1e6?(e/1e6).toFixed(t)+"M":e>1e3?(e/1e3).toFixed(t)+"K":e}function N(e,t=2){return e===0?"-":e>6e10?(e/6e10).toFixed(t)+"m":e>1e9?(e/1e9).toFixed(t)+"s":e>1e6?(e/1e6).toFixed(t)+"ms":e>1e3?(e/1e3).toFixed(t)+"\xB5s":e+"ns"}function I(e,t=0){for(;e.children.length>t;)e.removeChild(e.lastChild)}var v="local-api/",Q=v+"asnList",Y=v+"flowTimeline/",V=[],W=[],Z=[],K=[],O=Number.MAX_SAFE_INTEGER,j=Number.MIN_SAFE_INTEGER,L=20,h=0,w="asn",G="start",ee=[{tag:"start",label:"Start Time"},{tag:"duration",label:"Duration"},{tag:"bytes",label:"Bytes"}];function q(e){return new Date(e*1e3).toLocaleString()}function te(){$.get(Q,e=>{V=e,e.sort((n,d)=>d.count-n.count);let t=document.createElement("div");t.classList.add("dropdown");let l=document.createElement("button");l.classList.add("btn","btn-secondary","dropdown-toggle","btn-sm"),l.type="button",l.innerHTML="Select ASN",l.setAttribute("data-bs-toggle","dropdown"),l.setAttribute("aria-expanded","false"),t.appendChild(l);let s=document.createElement("ul");s.classList.add("dropdown-menu"),e.length===0&&e.push({asn:0,name:"No data",count:0}),e.forEach(n=>{let d=document.createElement("li");d.innerHTML="#"+n.asn+" "+n.name+" ("+n.count+")",d.classList.add("dropdown-item"),d.onclick=()=>{oe(n.asn),w="asn"},s.appendChild(d)}),t.appendChild(s);let i=document.getElementById("asnList");I(i),i.appendChild(t)})}function ne(){$.get(v+"countryList",e=>{W=e,e.sort((n,d)=>d.count-n.count);let t=document.createElement("div");t.classList.add("dropdown");let l=document.createElement("button");l.classList.add("btn","btn-secondary","dropdown-toggle","btn-sm"),l.type="button",l.innerHTML="Select Country",l.setAttribute("data-bs-toggle","dropdown"),l.setAttribute("aria-expanded","false"),t.appendChild(l);let s=document.createElement("ul");s.classList.add("dropdown-menu"),e.forEach(n=>{let d=document.createElement("li");d.innerHTML="<img alt='"+n.iso_code+"' src='flags/"+n.iso_code.toLowerCase()+".svg' height=12 width=12 />"+n.name+" ("+n.count+")",d.classList.add("dropdown-item"),d.onclick=()=>{re(n.iso_code),w="country"},s.appendChild(d)}),t.appendChild(s);let i=document.getElementById("countryList");I(i),i.appendChild(t)})}function le(){$.get(v+"protocolList",e=>{Z=e,e.sort((n,d)=>d.count-n.count);let t=document.createElement("div");t.classList.add("dropdown");let l=document.createElement("button");l.classList.add("btn","btn-secondary","dropdown-toggle","btn-sm"),l.type="button",l.innerHTML="Select Protocol",l.setAttribute("data-bs-toggle","dropdown"),l.setAttribute("aria-expanded","false"),t.appendChild(l);let s=document.createElement("ul");s.classList.add("dropdown-menu"),e.forEach(n=>{let d=document.createElement("li");d.innerHTML=n.protocol+" ("+n.count+")",d.classList.add("dropdown-item"),d.onclick=()=>{ae(n.protocol),w="protocol"},s.appendChild(d)}),t.appendChild(s);let i=document.getElementById("protocolList");I(i),i.appendChild(t)})}function oe(e){$.get(Y+encodeURI(e),t=>{h=0,_(e,t)})}function re(e){let t=v+"countryTimeline/"+encodeURI(e);$.get(t,l=>{h=0,_(e,l)})}function ae(e){let t=v+"protocolTimeline/"+encodeURI(e.replace("/","_"));$.get(t,l=>{h=0,_(e,l)})}function _(e,t){let l=document.createElement("h2");if(w==="asn"){let o=V.find(a=>a.asn===e);if(o==null){console.error("Could not find ASN: "+e);return}l.innerText="ASN #"+e.toFixed(0)+" ("+o.name+")"}else if(w==="country"){let o=W.find(a=>a.iso_code===e);if(o==null){console.error("Could not find country: "+e);return}l.innerHTML="<img alt='"+o.iso_code+"' src='flags/"+o.iso_code.toLowerCase()+".svg' height=32 width=32 />"+o.name}else w==="protocol"&&(l.innerText="Protocol: "+e);let s=document.getElementById("asnDetails");switch(K=t,G){case"start":t.sort((o,a)=>o.start-a.start);break;case"duration":t.sort((o,a)=>a.duration_nanos-o.duration_nanos);break;case"bytes":t.sort((o,a)=>a.total_bytes.down+a.total_bytes.up-(o.total_bytes.down+o.total_bytes.up))}let i=document.createElement("div");i.classList.add("row");let n=Number.MAX_SAFE_INTEGER,d=Number.MIN_SAFE_INTEGER;t.forEach(o=>{o.start<n&&(n=o.start),o.end>d&&(d=o.end)}),O=n,j=d;let m=document.createElement("div");m.classList.add("row");let p=document.createElement("div");p.classList.add("col-1","text-secondary"),p.innerText="Bytes",m.appendChild(p);let u=document.createElement("div");u.classList.add("col-1","text-secondary"),u.innerText="RTT",m.appendChild(u);let r=document.createElement("div");r.classList.add("col-1","text-secondary"),r.innerText="Client",m.appendChild(r);let E=document.createElement("div");E.classList.add("col-1","text-secondary"),E.innerText="Remote",m.appendChild(E);let C=document.createElement("div");C.classList.add("col-1","text-secondary"),C.innerText="Protocol",m.appendChild(C);let M=document.createElement("div");M.classList.add("col-4","text-secondary"),M.innerText=q(n),m.appendChild(M);let S=document.createElement("div");S.classList.add("col-3","text-secondary","text-end"),S.innerText=q(d),m.appendChild(S);let k=document.createElement("div");for(let o=h*L;o<(h+1)*L&&!(o>=t.length);o++){let a=t[o],B=document.createElement("div");B.classList.add("col-1","text-secondary","small"),B.innerText=X(a.total_bytes.down,0)+" / "+X(a.total_bytes.up),i.appendChild(B);let D=document.createElement("div");D.classList.add("col-1","text-secondary","small");let z=a.rtt[0]!==void 0?N(a.rtt[0].nanoseconds,0):"-",J=a.rtt[1]!==void 0?N(a.rtt[1].nanoseconds,0):"-";D.innerText=z+" / "+J,i.appendChild(D);let A=document.createElement("div");if(A.classList.add("col-1","text-secondary","small"),a.circuit_id!==""){let R=document.createElement("a");R.href="/circuit.html?id="+encodeURI(a.circuit_id),R.innerText=a.circuit_name,R.classList.add("redactable"),R.style.textOverflow="ellipsis",A.appendChild(R)}else A.innerText=a.circuit_name;i.appendChild(A);let F=document.createElement("div");F.classList.add("col-1","text-secondary","small"),F.innerText=a.remote_ip,i.appendChild(F);let H=document.createElement("div");H.classList.add("col-1","text-secondary","small"),H.innerText=a.protocol,i.appendChild(H);let U=document.createElement("div");U.classList.add("col-7");let P=document.createElement("canvas");P.id="flowCanvas"+o,P.style.width="100%",P.style.height="20px",U.appendChild(P),i.appendChild(U),k.appendChild(i)}I(s),s.appendChild(l);let x=document.createElement("button");x.classList.add("btn","btn-secondary","btn-sm","ms-2"),x.innerHTML="<i class='fa fa-arrow-right'></i> Next",x.onclick=()=>{h++,h*L>=t.length&&(h=Math.floor(t.length/L)),_(e,t)};let g=document.createElement("button");x.classList.add("btn","btn-secondary","btn-sm","me-2"),g.innerHTML="<i class='fa fa-arrow-left'></i> Prev",g.onclick=()=>{h--,h<0&&(h=0),_(e,t)};let y=document.createElement("span");y.classList.add("text-secondary","small","ms-2","me-2"),y.innerText="Page "+(h+1)+" of "+Math.ceil(t.length/L),y.id="paginator";let c=document.createElement("span");c.classList.add("text-secondary","small","ms-2","me-2"),c.innerText="Sort by: ";let T=document.createElement("select");T.classList.add("small"),T.id="sortBox",ee.forEach(o=>{let a=document.createElement("option");a.value=o.tag,a.innerText=o.label,o.tag===G&&(a.selected=!0),T.appendChild(a)}),T.onchange=()=>{G=document.getElementById("sortBox").value,_(e,t)};let b=document.createElement("div");b.classList.add("mb-2"),b.appendChild(g),b.appendChild(y),b.appendChild(x),b.appendChild(c),b.appendChild(T),s.appendChild(b),s.appendChild(m),s.appendChild(k),requestAnimationFrame(()=>{setTimeout(()=>{de()})})}function f(e,t){let l=j-O;return(e-O)/l*t}function de(){var e=getComputedStyle(document.body);let t=e.getPropertyValue("--bs-tertiary-bg"),l=e.getPropertyValue("--bs-primary"),s=e.getPropertyValue("--bs-secondary");for(let i=h*L;i<(h+1)*L;i++){let n=K[i],d="flowCanvas"+i,m=document.getElementById(d);if(m===null)break;let{width:p,height:u}=m.getBoundingClientRect();m.width=p,m.height=u;let r=m.getContext("2d");r.fillStyle=t,r.fillRect(f(n.start,p),0,f(n.end,p),u),r.strokeStyle="red",n.retransmit_times_down.forEach(c=>{r.beginPath(),r.moveTo(f(c,p),u/2),r.lineTo(f(c,p),u),r.stroke()}),n.retransmit_times_up.forEach(c=>{r.beginPath(),r.moveTo(f(c,p),0),r.lineTo(f(c,p),u/2),r.stroke()}),r.strokeStyle=s,r.beginPath(),r.moveTo(f(n.start,p),u/2),r.lineTo(f(n.end,p),u/2),r.stroke();let E=0,C=0;n.throughput.forEach(c=>{c.down>E&&(E=c.down),c.up>C&&(C=c.up)}),r.strokeStyle=l,r.beginPath();let M=n.throughput.length,S=f(n.start,p),x=(f(n.end,p)-S)/M,g=f(n.start,p);r.moveTo(g,u/2);let y=u-4;n.throughput.forEach(c=>{let T=c.down/E,b=u/2-T*(y/2);r.lineTo(g,b),g+=x}),r.stroke(),g=f(n.start,p),r.moveTo(g,u/2),n.throughput.forEach(c=>{let T=c.up/C,b=u/2+T*(y/2);r.lineTo(g,b),g+=x}),r.stroke()}}te();ne();le();})();
//# sourceMappingURL=asn_explorer.js.map
