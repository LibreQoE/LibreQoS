{
  "version": 3,
  "sources": ["../src/helpers/dark_mode.js", "../src/graphs/dashboard_graph.js", "../src/helpers/scaling.js", "../src/flow_map.js"],
  "sourcesContent": ["export function initDayNightMode() {\n    if (isDarkMode()) {\n        const darkModeSwitch = document.getElementById('darkModeSwitch');\n        darkModeSwitch.checked = true;\n        document.body.classList.add('dark-mode');\n        document.documentElement.setAttribute('data-bs-theme', \"dark\");\n    } else {\n        document.body.classList.remove('dark-mode');\n        document.documentElement.setAttribute('data-bs-theme', \"light\");\n    }\n\n    document.addEventListener('DOMContentLoaded', (event) => {\n        const darkModeSwitch = document.getElementById('darkModeSwitch');\n        const currentTheme = localStorage.getItem('theme');\n\n        if (currentTheme === 'dark') {\n            document.body.classList.add('dark-mode');\n            darkModeSwitch.checked = true;\n        }\n\n        darkModeSwitch.addEventListener('change', () => {\n            if (darkModeSwitch.checked) {\n                document.body.classList.add('dark-mode');\n                document.documentElement.setAttribute('data-bs-theme', \"dark\");\n                localStorage.setItem('theme', 'dark');\n                window.graphPalette = [\n                    '#4992ff',\n                    '#7cffb2',\n                    '#fddd60',\n                    '#ff6e76',\n                    '#58d9f9',\n                    '#05c091',\n                    '#ff8a45',\n                    '#8d48e3',\n                    '#dd79ff'\n                ];\n            } else {\n                document.body.classList.remove('dark-mode');\n                document.documentElement.setAttribute('data-bs-theme', \"light\");\n                localStorage.setItem('theme', 'light');\n                window.graphPalette = [\n                    '#d87c7c',\n                    '#919e8b',\n                    '#d7ab82',\n                    '#6e7074',\n                    '#61a0a8',\n                    '#efa18d',\n                    '#787464',\n                    '#cc7e63',\n                    '#724e58',\n                    '#4b565b'\n                ];\n            }\n            if (window.graphList !== undefined) {\n                window.graphList.forEach((graph) => {\n                    graph.chart.dispose();\n                    if (darkModeSwitch.checked) {\n                        graph.chart = echarts.init(graph.dom, 'dark');\n                    } else {\n                        graph.chart = echarts.init(graph.dom, 'vintage');\n                    }\n                    graph.chart.setOption(graph.option);\n                    graph.onThemeChange();\n                });\n            }\n        });\n    });\n}\n\nexport function isDarkMode() {\n    const currentTheme = localStorage.getItem('theme');\n    if (currentTheme === null) {\n        if (window.matchMedia('(prefers-color-scheme: dark)').matches) {\n            localStorage.setItem('theme', 'dark');\n            return true;\n        } else {\n            localStorage.setItem('theme', 'light');\n            return false;\n        }\n    }\n    return currentTheme === 'dark';\n}", "import {isDarkMode} from \"../helpers/dark_mode\";\n\nexport class DashboardGraph {\n    constructor(id) {\n        this.id = id;\n        this.dom = document.getElementById(id);\n        this.dom.classList.add(\"muted\");\n        if (isDarkMode()) {\n            window.graphPalette = [\n                '#4992ff',\n                '#7cffb2',\n                '#fddd60',\n                '#ff6e76',\n                '#58d9f9',\n                '#05c091',\n                '#ff8a45',\n                '#8d48e3',\n                '#dd79ff'\n            ];\n            this.chart = echarts.init(this.dom, 'dark');\n        } else {\n            window.graphPalette = [\n                '#d87c7c',\n                '#919e8b',\n                '#d7ab82',\n                '#6e7074',\n                '#61a0a8',\n                '#efa18d',\n                '#787464',\n                '#cc7e63',\n                '#724e58',\n                '#4b565b'\n            ];\n            this.chart = echarts.init(this.dom, 'vintage');\n        }\n        this.chart.showLoading();\n        this.option = {};\n\n        // Apply to the global list of graphs\n        if (window.graphList === undefined) {\n            window.graphList = [ this ];\n        } else {\n            window.graphList.push(this);\n        }\n    }\n\n    onThemeChange() {\n        // Override this if you have to\n    }\n}", "export function scaleNumber(n, fixed=2) {\n    if (n > 1000000000000) {\n        return (n / 1000000000000).toFixed(fixed) + \"T\";\n    } else if (n > 1000000000) {\n        return (n / 1000000000).toFixed(fixed) + \"G\";\n    } else if (n > 1000000) {\n        return (n / 1000000).toFixed(fixed) + \"M\";\n    } else if (n > 1000) {\n        return (n / 1000).toFixed(fixed) + \"K\";\n    }\n    return n;\n}\n\nexport function scaleNanos(n, precision=2) {\n    if (n === 0) return \"-\";\n    if (n > 60000000000) {\n        return (n / 60000000000).toFixed(precision) + \"m\";\n    }else if (n > 1000000000) {\n        return (n / 1000000000).toFixed(precision) + \"s\";\n    } else if (n > 1000000) {\n        return (n / 1000000).toFixed(precision) + \"ms\";\n    } else if (n > 1000) {\n        return (n / 1000).toFixed(precision) + \"\u00B5s\";\n    }\n    return n + \"ns\";\n}\n\nexport function colorRamp(n) {\n    if (n <= 100) {\n        return \"#aaffaa\";\n    } else if (n <= 150) {\n        return \"goldenrod\";\n    } else {\n        return \"#ffaaaa\";\n    }\n}\n\nexport function rttCircleSpan(rtt) {\n    let span = document.createElement(\"span\");\n    span.style.color = colorRamp(rtt);\n    span.innerText = \"\u2B24\";\n    return span;\n}\n\nexport function lerpGreenToRedViaOrange(value, max) {\n    let r = 0;\n    let g = 0;\n    let b = 0;\n    if (value < max / 2) {\n        r = 255;\n        g = Math.floor(255 * value / (max / 2));\n    } else {\n        r = Math.floor(255 * (max - value) / (max / 2));\n        g = 255;\n    }\n    return `rgb(${r}, ${g}, ${b})`;\n}\n\nexport function formatThroughput(throughput, limitInMbps) {\n    let limitBits = limitInMbps * 1000 * 1000;\n    let percent = 0;\n    if (limitBits > 0) {\n        percent = (throughput / limitBits) * 100;\n    }\n    let color = lerpGreenToRedViaOrange(100-percent, 100);\n    let blob = \"<span class='muted' style='color: \" + color + \"'>\u25A0</span>\";\n    blob += \"<span>\" + scaleNumber(throughput, 1) + \"bps</span>\";\n    return blob;\n}\n\nexport function formatRtt(rtt) {\n    if (rtt === undefined || rtt === null || rtt.nanoseconds === 0) {\n        return \"-\";\n    }\n    const limit = 200;\n    let percent = 0;\n    if (limit > 0) {\n        percent = (rtt / limit) * 100;\n    }\n    let color = lerpGreenToRedViaOrange(100-percent, 100);\n    let blob = \"<span class='muted' style='color: \" + color + \"'>\u25A0</span>\";\n    blob += \"<span>\" + parseFloat(rtt).toFixed(0) + \"ms</span>\";\n    return blob;\n}\n\nexport function formatRetransmit(retransmits) {\n    let percent = Math.min(100, retransmits) / 100;\n    let color = lerpColor([0, 255, 0], [255, 0, 0], percent);\n    return \"<span class='muted' style='color: \" + color + \"'>\u25A0</span>\" + retransmits + \"</span>\";\n}\n\nexport function formatCakeStat(n) {\n    let percent = Math.min(100, n) / 100;\n    let color = lerpColor([128, 128, 0], [255, 255, 255], percent);\n    let html = \"<span class='muted' class='retransmits' style='color: \" + color + \"'>\";\n    html += n;\n    html += \"</span>\";\n    return html;\n}\n\nexport function lerpColor(color1, color2, weight) {\n    var r = Math.round(color1[0] + (color2[0] - color1[0]) * weight);\n    var g = Math.round(color1[1] + (color2[1] - color1[1]) * weight);\n    var b = Math.round(color1[2] + (color2[2] - color1[2]) * weight);\n    return `rgb(${r}, ${g}, ${b})`;\n}\n\nexport function formatPercent(percent, digits=0) {\n    let color = lerpGreenToRedViaOrange(100-Math.min(100,percent), 100);\n    return \"<span class='muted' style='color: \" + color + \"'>\" + percent.toFixed(digits) + \"%</span>\";\n}\n\nexport function rttNanosAsSpan(rttNanos, precision=0) {\n    let rttInMs = Math.min(200, rttNanos / 1000000);\n    let color = lerpGreenToRedViaOrange(200 - rttInMs, 200);\n    let html = \"<span class='muted' style='color: \" + color + \"'>\u25A0</span> \" + scaleNanos(rttNanos, precision);\n    return html;\n}", "import { DashboardGraph } from \"./graphs/dashboard_graph\";\nimport {lerpGreenToRedViaOrange} from \"./helpers/scaling\";\n\nclass FlowMap extends DashboardGraph {\n    constructor(id) {\n        super(id);\n        let data = [];\n        this.option = {\n            geo3D: {\n                map: 'world',\n                shading: 'realistic',\n                silent: true,\n                environment: '#333',\n                realisticMaterial: {\n                    roughness: 0.8,\n                    metalness: 0\n                },\n                postEffect: {\n                    enable: true\n                },\n                groundPlane: {\n                    show: false\n                },\n                light: {\n                    main: {\n                        intensity: 1,\n                        alpha: 30\n                    },\n                    ambient: {\n                        intensity: 0\n                    }\n                },\n                viewControl: {\n                    distance: 70,\n                    alpha: 89,\n                    panMouseButton: 'left',\n                    rotateMouseButton: 'right'\n                },\n                itemStyle: {\n                    color: '#000'\n                },\n                regionHeight: 0.5\n            },\n            series: [\n                {\n                    type: 'scatter3D',\n                    coordinateSystem: 'geo3D',\n                    blendMode: 'lighter',\n                    lineStyle: {\n                        width: 0.2,\n                        opacity: 0.05\n                    },\n                    symbolSize: 2,\n                    data: data\n                }\n            ]\n        };\n        this.option && this.chart.setOption(this.option);\n    }\n\n    update(data) {\n        this.chart.hideLoading();\n        this.option.series[0].data = data;\n        this.chart.setOption(this.option);\n    }\n}\n\nfunction updateMap() {\n    $.get(\"/local-api/flowMap\", (data) => {\n        let output = [];\n        data.forEach((d) => {\n            let rtt = Math.min(200, d[4]);\n            let color = lerpGreenToRedViaOrange(200 - rtt, 200);\n            output.push({\n                value: [d[1], d[0]], // It wants lon/lat\n                itemStyle: {\n                    color: color,\n                }\n            });\n        });\n        map.update(output);\n\n        // Note that I'm NOT using a channel ticker here because of the amount of data\n        setTimeout(updateMap, 1000); // Keep on ticking!\n    });\n}\n\nlet map = new FlowMap(\"flowMap\");\nupdateMap()"],
  "mappings": "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",
  "names": ["isDarkMode", "currentTheme", "DashboardGraph", "id", "isDarkMode", "lerpGreenToRedViaOrange", "value", "max", "r", "g", "b", "FlowMap", "DashboardGraph", "id", "data", "updateMap", "output", "d", "rtt", "color", "lerpGreenToRedViaOrange", "map"]
}
