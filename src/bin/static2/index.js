(()=>{var tt=o=>{throw TypeError(o)};var xt=(o,e,t)=>e.has(o)||tt("Cannot "+t);var le=(o,e,t)=>e.has(o)?tt("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(o):e.set(o,t);var x=(o,e,t)=>(xt(o,e,"access private method"),t);var B=null;function vt(){return window.location.protocl==="https"?"wss://":"ws://"}function at(o,e){B&&B.close(),B=new WebSocket(vt()+window.location.host+"/websocket/ws"),B.onopen=()=>{for(let t=0;t<o.length;t++)B.send('{ "channel" : "'+o[t]+'"}')},B.onclose=()=>{B=null},B.onerror=t=>{B=null},B.onmessage=function(t){let a=JSON.parse(t.data);e(a)}}function qe(){B=null}function c(o,e=2){return o>1e12?(o/1e12).toFixed(e)+"T":o>1e9?(o/1e9).toFixed(e)+"G":o>1e6?(o/1e6).toFixed(e)+"M":o>1e3?(o/1e3).toFixed(e)+"K":o}function H(o,e=2){return o===0?"-":o>6e10?(o/6e10).toFixed(e)+"m":o>1e9?(o/1e9).toFixed(e)+"s":o>1e6?(o/1e6).toFixed(e)+"ms":o>1e3?(o/1e3).toFixed(e)+"\xB5s":o+"ns"}function L(o,e){let t=0,a=0,i=0;return o<e/2?(t=255,a=Math.floor(255*o/(e/2))):(t=Math.floor(255*(e-o)/(e/2)),a=255),"rgb(".concat(t,", ").concat(a,", ").concat(i,")")}function G(o,e){let t=e*1e3*1e3,a=0;t>0&&(a=o/t*100);let n="<span class='muted' style='color: "+L(100-a,100)+"'>\u25A0</span>";return n+="<span>"+c(o,1)+"bps</span>",n}function V(o){if(o==null||o.nanoseconds===0)return"-";let e=200,t=0;e>0&&(t=o/e*100);let i="<span class='muted' style='color: "+L(100-t,100)+"'>\u25A0</span>";return i+="<span>"+parseFloat(o).toFixed(0)+"ms</span>",i}function P(o){let e=Math.min(100,o)/100;return"<span class='muted' style='color: "+de([0,255,0],[255,0,0],e)+"'>\u25A0</span>"+o+"</span>"}function ae(o){let e=Math.min(100,o)/100,a="<span class='muted' class='retransmits' style='color: "+de([128,128,0],[255,255,255],e)+"'>";return a+=o,a+="</span>",a}function de(o,e,t){var a=Math.round(o[0]+(e[0]-o[0])*t),i=Math.round(o[1]+(e[1]-o[1])*t),n=Math.round(o[2]+(e[2]-o[2])*t);return"rgb(".concat(a,", ").concat(i,", ").concat(n,")")}function q(o,e=0){return"<span class='muted' style='color: "+L(100-Math.min(100,o),100)+"'>"+o.toFixed(e)+"%</span>"}function z(o,e=0){let t=Math.min(200,o/1e6);return"<span class='muted' style='color: "+L(200-t,200)+"'>\u25A0</span> "+H(o,e)}function ie(o){o.classList.add("redactable")}function pe(){let o=localStorage.getItem("redact");if(o===null)return localStorage.setItem("redact","false"),!1;if(o==="false")return!1;if(o==="true")return!0}function F(o,e){let t=document.createElement("h5");return t.innerHTML="<i class='fa fa-"+o+"'></i> "+e,t}function l(o,e=0,t="",a=""){let i=document.createElement("th");return i.classList.add("text-center"),a!==""&&(i.id=a),e>0&&(i.colSpan=e),t!==""?(i.setAttribute("data-bs-toggle","tooltip"),i.setAttribute("data-bs-placement","top"),i.setAttribute("data-bs-html","true"),i.setAttribute("title",t),i.innerHTML=o+" <i class='fas fa-info-circle'></i>"):i.innerText=o,i}function S(o,e=!1){let t=document.createElement("td");return e&&t.classList.add("redactable"),t.innerText=o,t}function I(o){let e=document.createElement("td");return e.innerHTML=o,e}function v(o,e){let t=1;for(o.includes("___")&&(t=0);e.children.length>t;)e.removeChild(e.lastChild)}function it(o,e=0){for(;o.children.length>e;)o.removeChild(o.lastChild)}function st(){let e=[].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]')).map(function(t){return new bootstrap.Tooltip(t)})}function Et(){let o=document.createElement("thead");return o.classList.add("small"),o.appendChild(l("IP Address/Circuit")),o.appendChild(l("Plan")),o.appendChild(l("DL \u2B07\uFE0F")),o.appendChild(l("UL \u2B06\uFE0F")),o.appendChild(l("RTT (ms)")),o.appendChild(l("TCP Retransmits",2)),o}function Lt(o){let e=document.createElement("tr");if(e.classList.add("small"),o.circuit_id!==""){let d=document.createElement("td"),h=document.createElement("a");h.href="circuit.html?id="+encodeURI(o.circuit_id),h.innerText=o.ip_address,ie(h),d.append(h),e.append(d)}else{let d=document.createElement("td");d.innerText=o.ip_address,ie(d),e.append(d)}let t=document.createElement("td");t.innerText=o.plan.down+" / "+o.plan.up,e.append(t);let a=document.createElement("td");a.innerHTML=G(o.bits_per_second.down,o.plan.down),e.append(a);let i=document.createElement("td");i.innerHTML=G(o.bits_per_second.up,o.plan.up),e.append(i);let n=document.createElement("td");n.innerHTML=V(o.median_tcp_rtt),e.append(n);let s=document.createElement("td");s.innerHTML=P(o.tcp_retransmits.down),e.append(s);let r=document.createElement("td");return r.innerHTML=P(o.tcp_retransmits.up),e.append(r),e}function Q(o){let e=document.createElement("table");e.classList.add("table-sm","dash-table"),e.appendChild(Et());let t=document.createElement("tbody");return o.data.forEach(a=>{e.appendChild(Lt(a))}),e.appendChild(t),e}var p=class{constructor(e){this.slotNumber=e,this.id="dash_"+e,this.size=3,this.setupDone=!1}canBeSlowedDown(){return!1}sizeClasses(){switch(this.size){case 1:return["col-xs-12","col-sm-12","col-md-6","col-lg-3","col-xl-1","col-xxl-1"];case 2:return["col-xs-12","col-sm-12","col-md-6","col-lg-3","col-xl-2","col-xxl-2"];case 3:return["col-xs-12","col-sm-12","col-md-6","col-lg-3","col-xl-3","col-xxl-3"];case 4:return["col-xs-12","col-sm-12","col-md-6","col-lg-6","col-xl-4","col-xxl-4"];case 5:return["col-xs-12","col-sm-12","col-md-6","col-lg-6","col-xl-5","col-xxl-5"];case 6:return["col-xs-12","col-sm-12","col-md-6","col-lg-6","col-xl-6","col-xxl-6"];case 7:return["col-xs-12","col-sm-12","col-md-12","col-lg-12","col-xl-7","col-xxl-7"];case 8:return["col-xs-12","col-sm-12","col-md-12","col-lg-12","col-xl-8","col-xxl-8"];case 9:return["col-xs-12","col-sm-12","col-md-12","col-lg-12","col-xl-9","col-xxl-9"];case 10:return["col-xs-12","col-sm-12","col-md-12","col-lg-12","col-xl-10","col-xxl-10"];case 11:return["col-xs-12","col-sm-12","col-md-12","col-lg-12","col-xl-11","col-xxl-11"];case 12:return["col-xs-12","col-sm-12","col-md-12","col-lg-12","col-xl-12","col-xxl-12"];default:return["col-3"]}}title(){return"Someone forgot to set a title"}tooltip(){return null}subscribeTo(){return[]}onMessage(e){console.log(e)}setupOnce(e){this.setupDone||this.setup(e),this.setupDone=!0,st()}setup(){}graphDivId(){return this.id+"_graph"}graphDiv(){let e=document.createElement("div");return e.id=this.id+"_graph",e.classList.add("dashgraph"),e}buildContainer(){let e=document.createElement("div");e.id=this.id;let t=this.sizeClasses();for(let n=0;n<t.length;n++)e.classList.add(t[n]);e.classList.add("dashbox");let a=document.createElement("h5");a.classList.add("dashbox-title"),a.innerText=this.title();let i=this.tooltip();if(i!==null){let n=document.createElement("span");n.style.marginLeft="5px";let s=document.createElement("a");s.title=i,s.setAttribute("data-bs-toggle","tooltip"),s.setAttribute("data-bs-placement","top"),s.setAttribute("data-bs-html","true"),s.innerHTML="<i class='fas fa-info-circle'></i>",n.appendChild(s),a.appendChild(n)}return e.appendChild(a),e}};function ot(){let o=localStorage.getItem("theme");return o===null?window.matchMedia("(prefers-color-scheme: dark)").matches?(localStorage.setItem("theme","dark"),!0):(localStorage.setItem("theme","light"),!1):o==="dark"}var g=class{constructor(e){this.id=e,this.dom=document.getElementById(e),this.dom.classList.add("muted"),ot()?(window.graphPalette=["#4992ff","#7cffb2","#fddd60","#ff6e76","#58d9f9","#05c091","#ff8a45","#8d48e3","#dd79ff"],this.chart=echarts.init(this.dom,"dark")):(window.graphPalette=["#d87c7c","#919e8b","#d7ab82","#6e7074","#61a0a8","#efa18d","#787464","#cc7e63","#724e58","#4b565b"],this.chart=echarts.init(this.dom,"vintage")),this.chart.showLoading(),this.option={},window.graphList===void 0?window.graphList=[this]:window.graphList.push(this)}onThemeChange(){}};var he=class extends g{constructor(e){super(e),this.option={series:[{type:"gauge",axisLine:{lineStyle:{width:10,color:[[.5,"green"],[.8,"orange"],[1,"#fd666d"]]}},pointer:{icon:"path://M2.9,0.7L2.9,0.7c1.4,0,2.6,1.2,2.6,2.6v115c0,1.4-1.2,2.6-2.6,2.6l0,0c-1.4,0-2.6-1.2-2.6-2.6V3.3C0.3,1.9,1.4,0.7,2.9,0.7z",itemStyle:{color:"red"},width:4},axisTick:{distance:-10,length:8,lineStyle:{color:"#fff",width:2}},splitLine:{distance:-15,length:15,lineStyle:{color:"#999",width:4}},axisLabel:{color:"inherit",distance:16,fontSize:10,formatter:t=>c(t,1)},detail:{valueAnimation:!0,formatter:t=>c(t),color:"inherit",fontSize:12},title:{fontSize:14,color:"red"},data:[{name:"DOWN",value:0,title:{offsetCenter:["40%","75%"]},detail:{offsetCenter:["40%","95%"]}}]},{type:"gauge",axisLine:{lineStyle:{width:10,color:[[.5,"green"],[.8,"orange"],[1,"#fd666d"]]}},pointer:{itemStyle:{color:"orange"},length:"80%",icon:"path://M2.9,0.7L2.9,0.7c1.4,0,2.6,1.2,2.6,2.6v115c0,1.4-1.2,2.6-2.6,2.6l0,0c-1.4,0-2.6-1.2-2.6-2.6V3.3C0.3,1.9,1.4,0.7,2.9,0.7z"},axisTick:{distance:-10,length:8,lineStyle:{color:"#fff",width:2}},splitLine:{distance:-15,length:15,lineStyle:{color:"#999",width:4}},axisLabel:{color:"inherit",distance:16,fontSize:10,formatter:t=>c(t,1)},detail:{valueAnimation:!0,formatter:t=>c(t),color:"inherit",fontSize:12},title:{fontSize:14,color:"orange"},data:[{name:"UP",value:0,title:{offsetCenter:["-40%","75%"]},detail:{offsetCenter:["-40%","95%"]}}]}]},this.option&&this.chart.setOption(this.option)}update(e,t,a,i){this.chart.hideLoading(),this.option.series[0].data[0].value=e,this.option.series[1].data[0].value=t,this.option.series[0].min=0,this.option.series[0].max=a*1e6,this.option.series[1].min=0,this.option.series[1].max=i*1e6,this.chart.setOption(this.option)}};var ce=class extends p{title(){return"Throughput Bits/Second"}tooltip(){return"<h5>Throughput Bits/Second</h5><p>Shows the current throughput in bits per second. Traffic is divided between upload (from the ISP) and download (to the ISP) traffic.</p>"}subscribeTo(){return["Throughput"]}buildContainer(){let e=super.buildContainer();return e.appendChild(this.graphDiv()),e}setup(){super.setup(),this.graph=new he(this.graphDivId())}onMessage(e){e.event==="Throughput"&&this.graph.update(e.data.bps.down,e.data.bps.up,e.data.max.down,e.data.max.up)}};var ue=class extends g{constructor(e){super(e),this.option={grid:{x:"15%"},xAxis:{type:"value",axisLabel:{formatter:t=>c(t,0)}},yAxis:{type:"category",data:["UP","DN"]},series:[{type:"bar",data:[0,0]}]},this.option&&this.chart.setOption(this.option)}update(e,t){this.chart.hideLoading(),this.option.series[0].data=[{value:t},{value:e}],this.chart.setOption(this.option)}};var me=class extends p{title(){return"Throughput Packets/Second"}tooltip(){return"<h5>Throughput Packets/Second</h5><p>Shows the current throughput in packets per second. Traffic is divided between upload (from the ISP) and download (to the ISP) traffic.</p>"}subscribeTo(){return["Throughput"]}buildContainer(){let e=super.buildContainer();return e.appendChild(this.graphDiv()),e}setup(){super.setup(),this.graph=new ue(this.graphDivId())}onMessage(e){e.event==="Throughput"&&this.graph.update(e.data.pps.down,e.data.pps.up)}};var fe=class extends g{constructor(e){super(e),this.option={series:[{type:"pie",radius:"50%",data:[{name:"Shaped",value:0},{name:"Unshaped",value:0}]}],tooltip:{trigger:"item"}},this.option&&this.chart.setOption(this.option)}update(e,t){this.chart.hideLoading(),this.option.series[0].data[0].value=e,this.option.series[0].data[1].value=t-e,this.chart.setOption(this.option)}};var be=class extends p{title(){return"Shaped/Unshaped Traffic"}tooltip(){return"<h5>Shaped/Unshaped Traffic</h5><p>Shows the amount of traffic that is shaped and unshaped. Shaped traffic is limited by the configured bandwidth limits, while unshaped traffic is not.</p>"}subscribeTo(){return["Throughput"]}buildContainer(){let e=super.buildContainer();return e.appendChild(this.graphDiv()),e}setup(){super.setup(),this.graph=new fe(this.graphDivId())}onMessage(e){if(e.event==="Throughput"){let t=e.data.shaped_bps.down+e.data.shaped_bps.up,a=e.data.bps.down+e.data.bps.up;this.graph.update(t,a)}}};var nt=60*5,ge=class extends g{constructor(e){super(e),this.ringbuffer=new Qe(nt);let t=[];for(let a=0;a<nt;a++)t.push(a);this.option={grid:{x:"15%"},legend:{orient:"horizontal",right:10,top:"bottom",selectMode:!1,data:[{name:"Active/Tracked",icon:"circle"}],textStyle:{color:"#aaa"}},xAxis:{type:"category",data:t},yAxis:{type:"value",axisLabel:{formatter:a=>c(Math.abs(a),0)}},series:[{name:"Active/Tracked",data:[],type:"line",symbol:"none"}],tooltip:{trigger:"item"},animation:!1},this.option&&this.chart.setOption(this.option)}update(e,t){this.chart.hideLoading(),this.ringbuffer.push(e,t);let a=this.ringbuffer.series();this.option.series[0].data=a[0],this.chart.setOption(this.option)}},Qe=class{constructor(e){this.size=e;let t=[];for(let a=0;a<e;a++)t.push([0,0]);this.head=0,this.data=t}push(e,t){this.data[this.head]=[e,t],this.head+=1,this.head%=this.size}series(){let e=[[],[]];for(let t=this.head;t<this.size;t++)e[0].push(this.data[t][0]),e[1].push(this.data[t][1]);for(let t=0;t<this.head;t++)e[0].push(this.data[t][0]),e[1].push(this.data[t][1]);return e}};var we=class extends p{title(){return"Tracked Flows"}tooltip(){return"<h5>Tracked Flows</h5><p>Number of flows tracked by LibreQoS. Flows are either a TCP connection, or a UDP/ICMP connection with matching endpoints and port/request type numbers. Completed flows are flows that have finished transmitting data, and have been submitted to netflow and the flow analysis system.</p>"}subscribeTo(){return["FlowCount"]}buildContainer(){let e=super.buildContainer();return e.appendChild(this.graphDiv()),e}setup(){super.setup(),this.graph=new ge(this.graphDivId())}onMessage(e){e.event==="FlowCount"&&this.graph.update(e.active,e.recent)}};var rt=60*5,Ce=class extends g{constructor(e){super(e),this.ringbuffer=new je(rt);let t=[];for(let a=0;a<rt;a++)t.push(a);this.option={legend:{orient:"horizontal",right:10,top:"bottom",selectMode:!1,data:[{name:"Shaped Traffic",icon:"circle",itemStyle:{color:window.graphPalette[0]}},{name:"Unshaped Traffic",icon:"circle",itemStyle:{color:window.graphPalette[1]}}],textStyle:{color:"#aaa"}},xAxis:{type:"category",data:t},yAxis:{type:"value",axisLabel:{formatter:a=>c(Math.abs(a))}},series:[{name:"shaped0",data:[],type:"line",stack:"shaped",lineStyle:{opacity:0,color:window.graphPalette[0]},symbol:"none",areaStyle:{color:window.graphPalette[0]}},{name:"Shaped Traffic",data:[],type:"line",stack:"shaped",lineStyle:{opacity:0,color:window.graphPalette[0]},symbol:"none",areaStyle:{color:window.graphPalette[0]}},{name:"unshaped0",data:[],type:"line",lineStyle:{color:window.graphPalette[1]},symbol:"none"},{name:"Unshaped Traffic",data:[],type:"line",lineStyle:{color:window.graphPalette[1]},symbol:"none"}],tooltip:{trigger:"item"}},this.option&&this.chart.setOption(this.option)}onThemeChange(){super.onThemeChange(),this.option.legend.data[0].itemStyle.color=window.graphPalette[0],this.option.legend.data[1].itemStyle.color=window.graphPalette[1],this.option.series[0].lineStyle.color=window.graphPalette[0],this.option.series[0].areaStyle.color=window.graphPalette[0],this.option.series[1].lineStyle.color=window.graphPalette[0],this.option.series[1].areaStyle.color=window.graphPalette[0],this.option.series[2].lineStyle.color=window.graphPalette[1],this.option.series[3].lineStyle.color=window.graphPalette[1],this.chart.setOption(this.option)}update(e,t){this.chart.hideLoading(),this.ringbuffer.push(e,t);let a=this.ringbuffer.series();this.option.series[0].data=a[0],this.option.series[1].data=a[1],this.option.series[2].data=a[2],this.option.series[3].data=a[3],this.chart.setOption(this.option)}},je=class{constructor(e){this.size=e;let t=[];for(let a=0;a<e;a++)t.push([0,0,0,0]);this.head=0,this.data=t}push(e,t){this.data[this.head][1]=e.down,this.data[this.head][0]=0-e.up,this.data[this.head][2]=t.down,this.data[this.head][3]=0-t.up,this.head+=1,this.head%=this.size}series(){let e=[[],[],[],[]];for(let t=this.head;t<this.size;t++)for(let a=0;a<4;a++)e[a].push(this.data[t][a]);for(let t=0;t<this.head;t++)for(let a=0;a<4;a++)e[a].push(this.data[t][a]);return e}};var ye=class extends p{constructor(e){super(e)}title(){return"Last 5 Minutes Throughput"}tooltip(){return"<h5>Last 5 Minutes Throughput</h5><p>Shaped (AQM controlled and limited) and Unshaped (not found in your Shaped Devices file) traffic over the last five minutes.</p>"}subscribeTo(){return["Throughput"]}buildContainer(){let e=super.buildContainer();return e.appendChild(this.graphDiv()),e}setup(){super.setup(),this.graph=new Ce(this.graphDivId())}onMessage(e){e.event==="Throughput"&&this.graph.update(e.data.shaped_bps,e.data.bps)}};var R=50,Te=class extends g{constructor(e){super(e);let t=[],a=[];for(let i=0;i<R;i++)t.push({value:i,itemStyle:{color:L(R-i,R)}}),a.push((i*10).toString());this.option={xAxis:{type:"category",data:a,name:"RTT"},yAxis:{type:"value",name:"Samples"},series:{data:t,type:"bar"}},this.option&&this.chart.setOption(this.option)}update(e){this.chart.hideLoading();for(let t=0;t<R;t++)this.option.series.data[t].value=e[t];this.chart.setOption(this.option)}};var xe=class extends p{constructor(e){super(e)}title(){return"Round-Trip Time Histogram"}tooltip(){return"<h5>Round-Trip Time Histogram</h5><p>Round-Trip Time Histogram, showing the distribution of round-trip times for packets in real-time.</p>"}subscribeTo(){return["RttHistogram"]}buildContainer(){let e=super.buildContainer();return e.appendChild(this.graphDiv()),e}setup(){super.setup(),this.graph=new Te(this.graphDivId())}onMessage(e){e.event==="RttHistogram"&&this.graph.update(e.data)}};var j=class extends p{constructor(e){super(e)}title(){return"Top 10 Downloaders"}tooltip(){return"<h5>Top 10 Downloaders</h5><p>Top 10 Downloaders by bits per second, including IP address, download and upload rates, round-trip time, TCP retransmits, and shaping plan.</p>"}subscribeTo(){return["TopDownloads"]}buildContainer(){let e=super.buildContainer();return e.style.height="250px",e.style.overflow="auto",e}canBeSlowedDown(){return!0}setup(){super.setup()}onMessage(e){if(e.event==="TopDownloads"){let t=document.getElementById(this.id),a=Q(e);v(this.id,t),t.appendChild(a)}}};var ve=class extends p{constructor(e){super(e)}canBeSlowedDown(){return!0}title(){return"Worst 10 Round-Trip Time"}tooltip(){return"<h5>Worst 10 Round-Trip Time</h5><p>Worst 10 Downloaders by round-trip time, including IP address, download and upload rates, round-trip time, TCP retransmits, and shaping plan.</p>"}subscribeTo(){return["WorstRTT"]}buildContainer(){let e=super.buildContainer();return e.style.height="250px",e.style.overflow="auto",e}setup(){super.setup()}onMessage(e){if(e.event==="WorstRTT"){let t=document.getElementById(this.id),a=Q(e);v(this.id,t),t.appendChild(a)}}};var J=class{constructor(){this.cache={}}set(e,t){this.cache[e]=t}get(e){return this.cache[e]===void 0?0:this.cache[e]}};var Z=class extends p{constructor(e){super(e),this.rttCache=new J}canBeSlowedDown(){return!0}title(){return"Top 10 Flows (by total bytes)"}tooltip(){return"<h5>Top 10 Flows (by total bytes)</h5><p>Top 10 Flows by total bytes, including protocol, local and remote IP addresses, download and upload rates, total bytes, round-trip time, TCP retransmits, remote ASN, and country.</p>"}subscribeTo(){return["TopFlowsBytes"]}buildContainer(){let e=super.buildContainer();return e.style.height="250px",e.style.overflow="auto",e}setup(){super.setup()}onMessage(e){if(e.event==="TopFlowsBytes"){let t=document.getElementById(this.id),a=document.createElement("table");a.classList.add("dash-table","table-sm","small");let i=document.createElement("thead");i.classList.add("small"),i.appendChild(l("IP/Circuit")),i.appendChild(l("Protocol")),i.appendChild(l("DL \u2B07\uFE0F")),i.appendChild(l("UL \u2B06\uFE0F")),i.appendChild(l("Total")),i.appendChild(l("RTT",2)),i.appendChild(l("TCP Retransmits",2)),i.appendChild(l("Remote ASN")),a.appendChild(i);let n=document.createElement("tbody");e.data.forEach(s=>{let r=document.createElement("tr");if(r.classList.add("small"),s.circuit_id!==""){let C=document.createElement("td"),k=document.createElement("a");k.href="circuit.html?id="+encodeURI(s.circuit_id),k.innerText=s.circuit_name,k.classList.add("redactable"),C.appendChild(k),r.appendChild(C)}else{let C=document.createElement("td");C.innerText=s.local_ip,r.appendChild(C)}let d=document.createElement("td");d.innerText=s.analysis,r.appendChild(d);let h=document.createElement("td");h.innerText=c(s.rate_estimate_bps.down,0),r.appendChild(h);let f=document.createElement("td");f.innerText=c(s.rate_estimate_bps.up,0),r.appendChild(f);let u=document.createElement("td");u.innerText=c(s.bytes_sent.down,0)+" / "+c(s.bytes_sent.up,0),r.appendChild(u),s.rtt_nanos.down!==void 0&&this.rttCache.set(s.remote_ip+s.analysis,s.rtt_nanos);let b=this.rttCache.get(s.remote_ip+s.analysis);b===0&&(b={down:0,up:0});let w=document.createElement("td");w.innerHTML=z(b.down),r.appendChild(w);let E=document.createElement("td");E.innerHTML=z(b.up),r.appendChild(E);let y=document.createElement("td");y.innerHTML=P(s.tcp_retransmits.down),r.appendChild(y);let D=document.createElement("td");D.innerHTML=P(s.tcp_retransmits.up),r.appendChild(D);let T=document.createElement("td");T.innerText=s.remote_asn_name,T.innerText===""&&(T.innerText=s.remote_ip),T.innerText.length>13&&T.classList.add("tiny"),r.appendChild(T),a.appendChild(r)}),a.appendChild(n),v(this.id,t),t.appendChild(a)}}};var X=class extends p{constructor(e){super(e),this.rttCache=new J}canBeSlowedDown(){return!0}title(){return"Top 10 Flows (by rate)"}tooltip(){return"<h5>Top 10 Flows (by rate)</h5><p>Top 10 Flows by rate, including protocol, local and remote IP addresses, download and upload rates, total bytes, round-trip time, TCP retransmits, remote ASN, and country.</p>"}subscribeTo(){return["TopFlowsRate"]}buildContainer(){let e=super.buildContainer();return e.style.height="250px",e.style.overflow="auto",e}setup(){super.setup()}onMessage(e){if(e.event==="TopFlowsRate"){let t=document.getElementById(this.id),a=document.createElement("table");a.classList.add("dash-table","table-sm","small");let i=document.createElement("thead");i.classList.add("small"),i.appendChild(l("IP/Circuit")),i.appendChild(l("Protocol")),i.appendChild(l("DL \u2B07\uFE0F")),i.appendChild(l("UL \u2B06\uFE0F")),i.appendChild(l("Total")),i.appendChild(l("RTT",2)),i.appendChild(l("TCP Retransmits",2)),i.appendChild(l("Remote ASN")),a.appendChild(i);let n=document.createElement("tbody");e.data.forEach(s=>{let r=document.createElement("tr");if(r.classList.add("small"),s.circuit_id!==""){let C=document.createElement("td"),k=document.createElement("a");k.href="circuit.html?id="+encodeURI(s.circuit_id),k.innerText=s.circuit_name,k.classList.add("redactable"),C.appendChild(k),r.appendChild(C)}else{let C=document.createElement("td");C.innerText=s.local_ip,r.appendChild(C)}let d=document.createElement("td");d.innerText=s.analysis,r.appendChild(d);let h=document.createElement("td");h.innerText=c(s.rate_estimate_bps.down,0),r.appendChild(h);let f=document.createElement("td");f.innerText=c(s.rate_estimate_bps.up,0),r.appendChild(f);let u=document.createElement("td");u.innerText=c(s.bytes_sent.down,0)+" / "+c(s.bytes_sent.up,0),r.appendChild(u),s.rtt_nanos.down!==void 0&&this.rttCache.set(s.remote_ip+s.analysis,s.rtt_nanos);let b=this.rttCache.get(s.remote_ip+s.analysis);b===0&&(b={down:0,up:0});let w=document.createElement("td");w.innerHTML=z(b.down),r.appendChild(w);let E=document.createElement("td");E.innerHTML=z(b.up),r.appendChild(E);let y=document.createElement("td");y.innerHTML=P(s.tcp_retransmits.down),r.appendChild(y);let D=document.createElement("td");D.innerHTML=P(s.tcp_retransmits.up),r.appendChild(D);let T=document.createElement("td");T.innerText=s.remote_asn_name,T.innerText===""&&(T.innerText=s.remote_ip),T.innerText.length>13&&T.classList.add("tiny"),r.appendChild(T),a.appendChild(r)}),a.appendChild(n),v(this.id,t),t.appendChild(a)}}};var Y=class extends p{constructor(e){super(e)}canBeSlowedDown(){return!0}title(){return"Endpoints by Country"}tooltip(){return"<h5>Endpoints by Country</h5><p>Top 10 endpoints by country/region, ordered by download speed. This data is gathered from recently completed flows, and may be a little behind realtime.</p>"}subscribeTo(){return["EndpointsByCountry"]}buildContainer(){let e=super.buildContainer();return e.style.height="250px",e.style.overflow="auto",e}setup(){super.setup()}onMessage(e){if(e.event==="EndpointsByCountry"){let t=document.getElementById(this.id),a=document.createElement("table");a.classList.add("dash-table","table-sm","small");let i=document.createElement("thead");i.classList.add("small"),i.appendChild(l("")),i.appendChild(l("Country")),i.appendChild(l("DL \u2B07\uFE0F")),i.appendChild(l("UL \u2B06\uFE0F")),i.appendChild(l("\u2B07 RTT")),i.appendChild(l("\uFE0F\uFE0F\u2B06 RTT")),a.appendChild(i);let n=document.createElement("tbody"),s=0;e.data.forEach(r=>{if(s>=10)return;let d=document.createElement("tr");d.classList.add("small");let h=document.createElement("td");if(r[3]!==null&&r[3]!==""){let y=r[3].toLowerCase();h.innerHTML="<img alt='Flag: "+y+"' src='flags/"+y+".svg' style='width: 20px; height: 20px;'>"}else h.innerText="\uFE0F";d.appendChild(h);let f=document.createElement("td");f.innerText=r[0],d.appendChild(f);let u=document.createElement("td");u.innerText=c(r[1].down),d.appendChild(u);let b=document.createElement("td");b.innerText=c(r[1].up),d.appendChild(b);let w=document.createElement("td");w.innerHTML=z(r[2][0]),d.appendChild(w);let E=document.createElement("td");E.innerHTML=z(r[2][1]),d.appendChild(E),a.appendChild(d),s++}),a.appendChild(n),v(this.id,t),t.appendChild(a)}}};var K=class extends p{constructor(e){super(e)}title(){return"Ethernet Protocols"}canBeSlowedDown(){return!0}tooltip(){return"<h5>Ethernet Protocols</h5><p>Bytes and packets transferred over IPv4 and IPv6, and the round-trip time for each.  This data is gathered from recently completed flows, and may be a little behind realtime.</p>"}subscribeTo(){return["EtherProtocols"]}buildContainer(){let e=super.buildContainer();return e.style.height="250px",e.style.overflow="auto",e}setup(){super.setup()}onMessage(e){if(e.event==="EtherProtocols"){let t=document.getElementById(this.id),a=document.createElement("table");a.classList.add("dash-table","table-sm","small");let i=document.createElement("thead");i.classList.add("small"),i.appendChild(l("Protocol")),i.appendChild(l("DL \u2B07\uFE0F")),i.appendChild(l("UL \u2B06\uFE0F")),i.appendChild(l("Packets \u2B07\uFE0F")),i.appendChild(l("Packets \u2B06\uFE0F")),i.appendChild(l("\u2B07 RTT")),i.appendChild(l("\uFE0F\uFE0F\u2B06 RTT")),a.appendChild(i);let n=document.createElement("tbody"),s=document.createElement("tr");s.classList.add("small"),s.appendChild(S("IPv4")),s.appendChild(S(c(e.data.v4_bytes.down))),s.appendChild(S(c(e.data.v4_bytes.up))),s.appendChild(S(c(e.data.v4_packets.down))),s.appendChild(S(c(e.data.v4_packets.up))),s.appendChild(S(H(e.data.v4_rtt.down))),s.appendChild(S(H(e.data.v4_rtt.up))),a.appendChild(s),s=document.createElement("tr"),s.appendChild(S("IPv6")),s.appendChild(S(c(e.data.v6_bytes.down))),s.appendChild(S(c(e.data.v6_bytes.up))),s.appendChild(S(c(e.data.v6_packets.down))),s.appendChild(S(c(e.data.v6_packets.up))),s.appendChild(S(H(e.data.v6_rtt.down))),s.appendChild(S(H(e.data.v6_rtt.up))),a.appendChild(s),a.appendChild(n),v(this.id,t),t.appendChild(a)}}};var ee=class extends p{constructor(e){super(e)}title(){return"IP Protocols"}canBeSlowedDown(){return!0}tooltip(){return"<h5>IP Protocols</h5><p>Bytes transferred over TCP/UDP/ICMP and port numbers, matched to common services when possible. This data is gathered from recently completed flows, and may be a little behind realtime.</p>"}subscribeTo(){return["IpProtocols"]}buildContainer(){let e=super.buildContainer();return e.style.height="250px",e.style.overflow="auto",e}setup(){super.setup()}onMessage(e){if(e.event==="IpProtocols"){let t=document.getElementById(this.id),a=document.createElement("table");a.classList.add("dash-table","table-sm","small");let i=document.createElement("thead");i.classList.add("small"),i.appendChild(l("Protocol")),i.appendChild(l("DL \u2B07\uFE0F")),i.appendChild(l("UL \u2B06\uFE0F")),a.appendChild(i);let n=document.createElement("tbody");e.data.forEach(s=>{let r=document.createElement("tr");r.classList.add("small"),r.appendChild(S(s[0])),r.appendChild(S(c(s[1].down))),r.appendChild(S(c(s[1].up))),a.appendChild(r)}),a.appendChild(n),v(this.id,t),t.appendChild(a)}}};var Ee=class extends p{constructor(e){super(e)}canBeSlowedDown(){return!0}title(){return"Worst 10 TCP Re-transmits"}tooltip(){return"<h5>Worst 10 TCP Re-transmits</h5><p>Worst 10 Downloaders by TCP retransmits, including IP address, download and upload rates, round-trip time, TCP retransmits, and shaping plan.</p>"}subscribeTo(){return["WorstRetransmits"]}buildContainer(){let e=super.buildContainer();return e.style.height="250px",e.style.overflow="auto",e}setup(){super.setup()}onMessage(e){if(e.event==="WorstRetransmits"){let t=document.getElementById(this.id),a=Q(e);v(this.id,t),t.appendChild(a)}}};var Le=class extends g{constructor(e){super(e);let t=[],a=[];for(let i=0;i<20;i++)t.push({value:i,itemStyle:{color:L(20-i,20)}}),a.push(i.toString());this.option={xAxis:{type:"category",data:a},yAxis:{type:"value",min:0,max:100},series:{data:t,type:"bar"}},this.option&&this.chart.setOption(this.option)}update(e){this.chart.hideLoading(),this.option.series.data=[];for(let t=0;t<e.length;t++)this.option.series.data.push({value:e[t],itemStyle:{color:L(100-e[t],100)}});this.chart.setOption(this.option)}};var Se=class extends p{constructor(e){super(e)}title(){return"CPU Utilization"}tooltip(){return"<h5>CPU Utilization</h5><p>Percentage of CPU time spent on user processes, system processes, and idle time. This includes both LibreQoS and anything else running on the server.</p>"}subscribeTo(){return["Cpu"]}buildContainer(){let e=super.buildContainer();return e.appendChild(this.graphDiv()),e}setup(){super.setup(),this.graph=new Le(this.graphDivId())}onMessage(e){e.event==="Cpu"&&this.graph.update(e.data)}};var De=class extends g{constructor(e){super(e),this.option={series:[{type:"pie",radius:"50%",data:[{name:"Free",value:0},{name:"Used",value:0}],label:{color:"#aaa"}}],tooltip:{trigger:"item"}},this.option&&this.chart.setOption(this.option)}update(e,t){this.chart.hideLoading(),this.option.series[0].data[0].value=e,this.option.series[0].data[1].value=t,this.chart.setOption(this.option)}};var ke=class extends p{constructor(e){super(e)}title(){return"RAM Utilization"}tooltip(){return"<h5>RAM Utilization</h5><p>Percentage of RAM used and free. This includes both LibreQoS and anything else running on the server.</p>"}subscribeTo(){return["Ram"]}buildContainer(){let e=super.buildContainer();return e.appendChild(this.graphDiv()),e}setup(){super.setup(),this.graph=new De(this.graphDivId())}onMessage(e){if(e.event==="Ram"){let t=e.data.total,a=e.data.used,i=t-a;this.graph.update(i,a)}}};var Ie=class extends p{constructor(e){super(e)}canBeSlowedDown(){return!0}title(){return"Network Tree"}tooltip(){return"<h5>Network Tree</h5><p>Summary of the top-level network tree, including branch name, download and upload rates, TCP retransmits, Cake marks, and Cake drops.</p>"}subscribeTo(){return["TreeSummary"]}buildContainer(){let e=super.buildContainer();e.style.height="250px",e.style.overflow="auto";let t=document.createElement("table");t.id=this.id+"_table",t.classList.add("dash-table","table-sm","mytable","small");let a=document.createElement("thead");return a.classList.add("small"),a.appendChild(l("Branch")),a.appendChild(l("DL \u2B07\uFE0F")),a.appendChild(l("UL \u2B06\uFE0F")),a.appendChild(l("Retr",2,"<h5>TCP Retransmits</h5><p>Number of TCP retransmits in the last second.</p>","tts_retransmits")),a.appendChild(l("Marks",2,"<h5>Cake Marks</h5><p>Number of times the Cake traffic manager has applied ECN marks to avoid congestion.</p>","tts_marks")),a.appendChild(l("Drops",2,"<h5>Cake Drops</h5><p>Number of times the Cake traffic manager has dropped packets to avoid congestion.</p>","tts_drops")),t.appendChild(a),e.appendChild(t),e}setup(){super.setup()}onMessage(e){if(e.event==="TreeSummary"){let t=document.getElementById(this.id+"_table");it(t,1),e.data.forEach(a=>{let i=document.createElement("tr");i.classList.add("small");let n=document.createElement("td"),s=document.createElement("a");s.href="/tree.html?id="+a[0],s.innerText=a[1].name,s.classList.add("redactable"),n.appendChild(s),i.appendChild(n),i.appendChild(I(G(a[1].current_throughput[0]*8,a[1].max_throughput[0]))),i.appendChild(I(G(a[1].current_throughput[1]*8,a[1].max_throughput[1]))),i.appendChild(I(P(a[1].current_retransmits[0]))),i.appendChild(I(P(a[1].current_retransmits[1]))),i.appendChild(I(ae(a[1].current_marks[0]))),i.appendChild(I(ae(a[1].current_marks[1]))),i.appendChild(I(ae(a[1].current_drops[0]))),i.appendChild(I(ae(a[1].current_drops[1]))),t.appendChild(i)})}}};var Re,lt,Me=class extends p{constructor(t,a){super(t);le(this,Re);this.selectedIndex=0,this.dashlets=a,this.titles=[],this.subsciptions=[],this.divIds=[],a.forEach(i=>{this.titles.push(i.title()),this.subsciptions.push(i.subscribeTo())})}subscribeTo(){return this.subsciptions}buildContainer(){let t=[],a=0;this.divIds=[],this.dashlets.forEach(s=>{s.size=12,s.id=this.id+"___"+a,this.divIds.push(this.id+"___"+a);let r=document.createElement("div");r.id=s.id,t.push(r),a++});let i=x(this,Re,lt).call(this);a=0;let n=document.createElement("div");return n.classList.add("row"),t.forEach(s=>{a>0&&(s.style.display="none"),n.appendChild(s),a++}),i.appendChild(n),i}setup(){super.setup(),this.dashlets.forEach(t=>{t.size=this.size,t.setup()})}onMessage(t){this.dashlets.forEach(a=>{a.onMessage(t)})}};Re=new WeakSet,lt=function(){let t=document.createElement("div");t.id=this.id;let a=this.sizeClasses();for(let h=0;h<a.length;h++)t.classList.add(a[h]);t.classList.add("dashbox");let i=document.createElement("h5");i.classList.add("dashbox-title"),i.innerText=this.title();let n=document.createElement("span");n.classList.add("dropdown");let s=document.createElement("span");s.innerHTML=" <i class='fa fa-chevron-down'></i>",s.setAttribute("data-bs-toggle","dropdown"),n.appendChild(s);let r=document.createElement("ul");r.classList.add("dropdown-menu");let d=0;return this.titles.forEach(h=>{let f=document.createElement("li"),u=document.createElement("a");u.classList.add("dropdown-item"),u.innerText=h;let b=d;u.onclick=()=>{this.divIds.forEach(E=>{$("#"+E).hide()});let w=this.divIds[b];$("#"+w).show()},f.appendChild(u),r.appendChild(f),d++}),n.appendChild(r),i.appendChild(n),t.appendChild(i),t};var Pe=class extends Me{constructor(e){let t=[new j(e*1e3+1),new X(e*1e3+2),new Z(e*1e3+3),new Y(e*1e3+4),new ee(e*1e3+5),new K(e*1e3+6)];super(e,t)}title(){return"Top-10 Downloaders"}canBeSlowedDown(){return!0}};var _e=class extends g{constructor(e){super(e),this.ring=new Je(300);let t=[];for(let n=0;n<300;n++)t.push(n.toString());let a=[];for(let n=0;n<R;n++)a.push({value:(n*10).toString(),itemStyle:{color:L(R-n,R)}});let i=this.ring.series();this.option={tooltip:{},xAxis3D:{type:"category",data:a,name:"RTT"},yAxis3D:{type:"category",data:t,name:"Time"},zAxis3D:{type:"value",name:"Samples"},grid3D:{viewControl:{autoRotate:!0}},series:[{type:"bar3D",data:i,label:{show:!1}}]},this.option&&this.chart.setOption(this.option)}update(e){this.chart.hideLoading(),this.ring.push(e),this.option.series[0].data=this.ring.series(),this.chart.setOption(this.option)}},Je=class{constructor(e){this.size=e;let t=[];for(let a=0;a<e;a++){let i=[];for(let n=0;n<R;n++)i.push(0);t.push(i)}this.head=0,this.data=t}push(e){this.data[this.head]=e,this.head+=1,this.head%=this.size}series(){let e=[],t=0;for(let a=0;a<this.head;a++){for(let i=0;i<R;i++){let n=this.data[a][i],s={value:[i,t,n],itemStyle:{color:L(R-i,R)}};e.push(s)}t++}for(let a=this.head;a<this.size;a++){for(let i=0;i<R;i++){let n=this.data[a][i],s={value:[i,t,n],itemStyle:{color:L(R-i,R)}};e.push(s)}t++}return e.reverse()}};var Be=class extends p{constructor(e){super(e)}title(){return"Round-Trip Time Histogram 3D"}tooltip(){return"<h5>Round-Trip Time Histogram 3D</h5><p>Round-Trip Time Histogram, expanded to include time as a third dimension. This can be helpful for seeing how your performance is changing over time.</p>"}subscribeTo(){return["RttHistogram"]}buildContainer(){let e=super.buildContainer(),t=this.graphDiv();return t.style.height="500px",e.appendChild(t),e}setup(){super.setup(),this.graph=new _e(this.graphDivId())}onMessage(e){e.event==="RttHistogram"&&this.graph.update(e.data)}};var dt=60*5,ze=class extends g{constructor(e){super(e),this.ringbuffer=new Ze(dt);let t=[];for(let a=0;a<dt;a++)t.push(a);this.option={legend:{orient:"horizontal",right:10,top:"bottom",selectMode:!1,data:[{name:"ECN Marks",icon:"circle",itemStyle:{color:window.graphPalette[0]}},{name:"Cake Drops",icon:"circle",itemStyle:{color:window.graphPalette[1]}}],textStyle:{color:"#aaa"}},xAxis:{type:"category",data:t},yAxis:{type:"value",axisLabel:{formatter:a=>c(Math.abs(a),0)}},series:[{name:"ECN Marks",data:[],type:"line",lineStyle:{color:window.graphPalette[0]},symbol:"none"},{name:"ECN Marks Up",data:[],type:"line",lineStyle:{color:window.graphPalette[0]},symbol:"none"},{name:"Cake Drops",data:[],type:"line",lineStyle:{color:window.graphPalette[1]},symbol:"none"},{name:"Cake Drops Up",data:[],type:"line",lineStyle:{color:window.graphPalette[1]},symbol:"none"}],tooltip:{trigger:"item"},animation:!1},this.option&&this.chart.setOption(this.option)}onThemeChange(){super.onThemeChange(),this.option.legend.data[0].itemStyle.color=window.graphPalette[0],this.option.legend.data[1].itemStyle.color=window.graphPalette[1],this.option.series[0].lineStyle.color=window.graphPalette[0],this.option.series[1].lineStyle.color=window.graphPalette[0],this.option.series[2].lineStyle.color=window.graphPalette[1],this.option.series[3].lineStyle.color=window.graphPalette[1]}update(e,t){this.chart.hideLoading(),this.ringbuffer.push(e,t);let a=this.ringbuffer.series();for(let i=0;i<this.option.series.length;i++)this.option.series[i].data=a[i];this.chart.setOption(this.option)}},Ze=class{constructor(e){this.size=e;let t=[];for(let a=0;a<e;a++)t.push({marks:{down:0,up:0},drops:{down:0,up:0}});this.head=0,this.data=t}push(e,t){this.data[this.head]={marks:e,drops:t},this.head+=1,this.head%=this.size}series(){let e=[[],[],[],[]];for(let t=this.head;t<this.size;t++)e[0].push(this.data[t].marks.down),e[1].push(0-this.data[t].marks.up),e[2].push(this.data[t].drops.down),e[3].push(0-this.data[t].drops.up);for(let t=0;t<this.head;t++)e[0].push(this.data[t].marks.down),e[1].push(0-this.data[t].marks.up),e[2].push(this.data[t].drops.down),e[3].push(0-this.data[t].drops.up);return e}};var Ne=class extends p{constructor(e){super(e)}title(){return"Cake Stats (Total)"}tooltip(){return'<h5>Cake Stats (Total)</h5><p>Total number of fair queueing interventions per second. ECN Marks label packets as having possible congestion, signalling the flow to slow down. Drops discard selected packets to "pace" the queue for efficient, fair, low-latency throughput.</p>'}subscribeTo(){return["QueueStatsTotal"]}buildContainer(){let e=super.buildContainer();return e.appendChild(this.graphDiv()),e}setup(){super.setup(),this.graph=new ze(this.graphDivId())}onMessage(e){e.event==="QueueStatsTotal"&&this.graph.update(e.marks,e.drops)}};var Ae=class extends p{constructor(e){super(e)}canBeSlowedDown(){return!0}title(){return"Tree Nodes At Capacity"}tooltip(){return"<h5>Tree Nodes at Capacity</h5><p>Distribution Nodes approaching their maximum capacity, possibly in need of an upgrade or a better shaping policy.</p>"}subscribeTo(){return["TreeCapacity"]}buildContainer(){let e=super.buildContainer();return e.style.height="250px",e.style.overflow="auto",e}setup(){super.setup()}onMessage(e){if(e.event==="TreeCapacity"){let t=document.getElementById(this.id),a=document.createElement("table");a.classList.add("dash-table","table-sm","small");let i=document.createElement("thead");i.classList.add("small"),i.appendChild(l("Node")),i.appendChild(l("% Utilization (DL)")),i.appendChild(l("% Utilization (UL)")),i.appendChild(l("RTT")),a.appendChild(i);let n=document.createElement("tbody");e.data.forEach(s=>{if(s.max_down===0||s.max_up===0)return;let r=s.down/s.max_down,d=s.up/s.max_up;if(r<.75&&d<.75)return;let h=document.createElement("tr");h.classList.add("small");let f=document.createElement("td"),u=document.createElement("a");u.href="/node.html?id="+s.id,u.innerText=s.name,u.classList.add("tiny","redactable"),f.appendChild(u),h.appendChild(f),h.appendChild(I(q(r*100))),h.appendChild(I(q(d*100))),h.appendChild(I(V(s.rtt))),n.appendChild(h)}),a.appendChild(n),v(this.id,t),t.appendChild(a)}}};var He=class extends p{constructor(e){super(e)}canBeSlowedDown(){return!0}title(){return"Circuits At Capacity"}tooltip(){return"<h5>Circuits at Capacity</h5><p>Customer circuits using close to their maximum capacities, and possibly in need of an upsell.</p>"}subscribeTo(){return["CircuitCapacity"]}buildContainer(){let e=super.buildContainer();return e.style.height="250px",e.style.overflow="auto",e}setup(){super.setup()}onMessage(e){if(e.event==="CircuitCapacity"){let t=document.getElementById(this.id);e.data.sort((r,d)=>d.capacity[0]-r.capacity[0]);let a=document.createElement("table");a.classList.add("dash-table","table-sm","small");let i=document.createElement("thead");i.classList.add("small"),i.appendChild(l("Circuit")),i.appendChild(l("% Utilization (DL)")),i.appendChild(l("% Utilization (UL)")),i.appendChild(l("RTT")),a.appendChild(i);let n=document.createElement("tbody"),s=0;e.data.forEach(r=>{if(r.capacity[0]<.9&&r.capacity[1]<.9||s>=7)return;let d=document.createElement("tr");d.classList.add("small");let h=document.createElement("td"),f=document.createElement("a");f.href="circuit.html?id="+encodeURI(r.circuit_id),f.innerText=r.circuit_name,ie(f),h.appendChild(f),d.appendChild(h),d.appendChild(I(q(r.capacity[0]*100))),d.appendChild(I(q(r.capacity[1]*100))),d.appendChild(I(V(r.rtt))),n.appendChild(d),s++}),a.appendChild(n),v(this.id,t),t.appendChild(a)}}};var Xe={},Ye=class extends g{constructor(e){super(e),this.option={series:[{nodeAlign:"left",type:"sankey",data:[],links:[]}]},this.option&&this.chart.setOption(this.option)}update(e,t){this.option.series[0].data=e,this.option.series[0].links=t,this.chart.hideLoading(),this.chart.setOption(this.option)}},Fe=class extends p{constructor(e){super(e)}canBeSlowedDown(){return!0}title(){return"Top Level Sankey"}tooltip(){return"<h5>Network Tree</h5><p>Summary of the top-level network tree, rendered as a Sankey. Ribbon width shows relative bandwidth, ribbon color percentage of capacity, and node color overall RTT.</p>"}subscribeTo(){return["TreeSummary"]}buildContainer(){let e=super.buildContainer();return e.appendChild(this.graphDiv()),e}setup(){super.setup(),this.graph=new Ye(this.graphDivId())}onMessage(e){if(e.event==="TreeSummary"){let t=pe(),a=[],i=[];a.push({name:"Root",label:"Root"}),e.data.forEach(n=>{let s={fontSize:9,color:"#999"};t&&(s.backgroundColor=s.color);let r=n[1].name,h=n[1].current_throughput[0]/1e6,f=n[1].max_throughput[0]/8,u=Math.min(100,h/f*100),b=L(100-u,100);n[1].rtts.length>0?Xe[r]=n[1].rtts[0]:Xe[r]=0;let w=L(200-Xe[r],200);a.push({name:n[1].name,label:s,itemStyle:{color:w}}),i.push({source:"Root",target:n[1].name,value:n[1].current_throughput[0]+n[1].current_throughput[1],lineStyle:{color:b}})}),this.graph.update(a,i)}}};var A=class extends g{constructor(e){super(e),this.nodeMap={},this.option={series:[{nodeAlign:"left",type:"sankey",data:[],links:[]}]},this.option&&this.chart.setOption(this.option)}update(e,t){this.option.series[0].data=e,this.option.series[0].links=t,this.chart.hideLoading(),this.chart.setOption(this.option),this.chart.on("click",a=>{let i=a.name;if(i=i.substring(0,i.indexOf(" (")),i.indexOf(" > ")===-1)this.nodeMap[i]!==void 0&&(window.location.href="/circuit.html?id="+encodeURI(this.nodeMap[i]));else{let n=a.data.target;n=n.substring(0,n.indexOf(" (")),this.nodeMap[n]!==void 0&&(window.location.href="/circuit.html?id="+encodeURI(this.nodeMap[n]))}})}processMessage(e){let t=[],a=[];t.push({name:"Root",label:"Root"}),this.nodeMap={},e.data.forEach(i=>{this.nodeMap[i.ip_address]=i.circuit_id;let n={fontSize:9,color:"#999"};pe()&&(n.backgroundColor=n.color);let s=i.ip_address+" ("+c(i.bits_per_second.down,0)+", "+i.tcp_retransmits.down+"/"+i.tcp_retransmits.up+")",d=i.bits_per_second.down/8/1e6,h=i.plan.down/8,f=Math.min(100,d/h*100),u=L(100-f,100),b=L(200-i.median_tcp_rtt,200),w=Math.min(100,i.tcp_retransmits.down+i.tcp_retransmits.up)/100,E=de([0,255,0],[255,0,0],w);t.push({name:s,label:n,itemStyle:{color:E,borderWidth:4,borderColor:b}}),a.push({source:"Root",target:s,value:i.bits_per_second.down,lineStyle:{color:u}})}),this.update(t,a)}};var Ue=class extends p{constructor(e){super(e)}title(){return"Top 10 Downloaders (Visual)"}tooltip(){return"<h5>Top 10 Downloaders</h5><p>The top-10 users by bits-per-second. The ribbon goes red as they approach capacity. The name border indicates round-trip time, while the main label color indicates TCP retransmits. The legend is current download speed, followed by number of retransmits.</p>"}subscribeTo(){return["TopDownloads"]}buildContainer(){let e=super.buildContainer();return e.appendChild(this.graphDiv()),e}canBeSlowedDown(){return!0}setup(){super.setup(),this.graph=new A(this.graphDivId())}onMessage(e){e.event==="TopDownloads"&&this.graph.processMessage(e)}};var Oe=class extends p{constructor(e){super(e)}canBeSlowedDown(){return!0}title(){return"Worst 10 Round-Trip Time"}tooltip(){return"<h5>Worst 10 Round-Trip Time</h5><p>Worst 10 Downloaders by round-trip time, including IP address, download and upload rates, round-trip time, TCP retransmits, and shaping plan.</p>"}subscribeTo(){return["WorstRTT"]}buildContainer(){let e=super.buildContainer();return e.appendChild(this.graphDiv()),e}setup(){super.setup(),this.graph=new A(this.graphDivId())}onMessage(e){e.event==="WorstRTT"&&this.graph.processMessage(e)}};var We=class extends p{constructor(e){super(e)}canBeSlowedDown(){return!0}title(){return"Worst 10 TCP Re-transmits"}tooltip(){return"<h5>Worst 10 TCP Re-transmits</h5><p>Worst 10 Downloaders by TCP retransmits, including IP address, download and upload rates, round-trip time, TCP retransmits, and shaping plan.</p>"}subscribeTo(){return["WorstRetransmits"]}buildContainer(){let e=super.buildContainer();return e.appendChild(this.graphDiv()),e}setup(){super.setup(),this.graph=new A(this.graphDivId())}onMessage(e){e.event==="WorstRetransmits"&&this.graph.processMessage(e)}};var Ge=class extends g{constructor(e){super(e),this.option={xAxis:{name:"Seconds",type:"value"},yAxis:{name:"Samples",type:"log"},series:{data:[],type:"scatter"}},this.option&&this.chart.setOption(this.option)}update(e){this.chart.hideLoading();let t=[];e.forEach(a=>{t.push([a.duration,a.count])}),this.option.series.data=t,this.chart.setOption(this.option)}};var $e=class extends p{constructor(e){super(e)}title(){return"Flow Duration"}tooltip(){return"<h5>Flow Duration</h5><p>How long do flows last in seconds? Most flows are very short, while some can last a very long time.</p>"}subscribeTo(){return["FlowDurations"]}buildContainer(){let e=super.buildContainer();return e.appendChild(this.graphDiv()),e}setup(){super.setup(),this.graph=new Ge(this.graphDivId())}onMessage(e){e.event==="FlowDurations"&&this.graph.update(e.data)}};var U=[{name:"Throughput Bits/Second",tag:"throughputBps",size:3},{name:"Throughput Packets/Second",tag:"throughputPps",size:3},{name:"Shaped/Unshaped Pie",tag:"shapedUnshaped",size:3},{name:"Tracked Flows Counter",tag:"trackedFlowsCount",size:3},{name:"Last 5 Minutes Throughput",tag:"throughputRing",size:6},{name:"Round-Trip Time Histogram",tag:"rttHistogram",size:6},{name:"Top 10 Downloaders",tag:"top10downloaders",size:6},{name:"Top 10 Downloaders (Visual)",tag:"top10downloadersV",size:6},{name:"Worst 10 Round-Trip Time",tag:"worst10downloaders",size:6},{name:"Worst 10 Round-Trip Time (Visual)",tag:"worst10downloadersV",size:6},{name:"Worst 10 Retransmits",tag:"worst10retransmits",size:6},{name:"Worst 10 Retransmits (Visual)",tag:"worst10retransmitsV",size:6},{name:"Top 10 Flows (total bytes)",tag:"top10flowsBytes",size:6},{name:"Top 10 Flows (rate)",tag:"top10flowsRate",size:6},{name:"Top 10 Endpoints by Country",tag:"top10endpointsCountry",size:6},{name:"Flow Duration",tag:"flowDuration",size:6},{name:"Ether Protocols",tag:"etherProtocols",size:6},{name:"IP Protocols",tag:"ipProtocols",size:6},{name:"CPU Utilization",tag:"cpu",size:3},{name:"RAM Utilization",tag:"ram",size:3},{name:"Network Tree Summary",tag:"treeSummary",size:6},{name:"Combined Top 10 Box",tag:"combinedTop10",size:6},{name:"Total Cake Stats",tag:"totalCakeStats",size:3},{name:"Circuits At Capacity",tag:"circuitCapacity",size:6},{name:"Tree Nodes At Capacity",tag:"treeCapacity",size:6},{name:"Network Tree Sankey",tag:"networkTreeSankey",size:6},{name:"Round-Trip Time Histogram 3D",tag:"rttHistogram3D",size:12}];function pt(o,e){let t=null;switch(o){case"throughputBps":t=new ce(e);break;case"throughputPps":t=new me(e);break;case"shapedUnshaped":t=new be(e);break;case"trackedFlowsCount":t=new we(e);break;case"throughputRing":t=new ye(e);break;case"rttHistogram":t=new xe(e);break;case"rttHistogram3D":t=new Be(e);break;case"top10downloaders":t=new j(e);break;case"top10downloadersV":t=new Ue(e);break;case"worst10downloaders":t=new ve(e);break;case"worst10downloadersV":t=new Oe(e);break;case"worst10retransmits":t=new Ee(e);break;case"worst10retransmitsV":t=new We(e);break;case"top10flowsBytes":t=new Z(e);break;case"top10flowsRate":t=new X(e);break;case"top10endpointsCountry":t=new Y(e);break;case"etherProtocols":t=new K(e);break;case"ipProtocols":t=new ee(e);break;case"flowDuration":t=new $e(e);break;case"cpu":t=new Se(e);break;case"ram":t=new ke(e);break;case"treeSummary":t=new Ie(e);break;case"combinedTop10":t=new Pe(e);break;case"totalCakeStats":t=new Ne(e);break;case"circuitCapacity":t=new He(e);break;case"treeCapacity":t=new Ae(e);break;case"networkTreeSankey":t=new Fe(e);break;default:return console.log("I don't know how to construct a widget of type ["+o+"]"),null}return t}var m,ht,ct,ut,mt,ft,bt,te,Ke,gt,se,St,Dt,Ve=class{constructor(e){le(this,m);this.divName=e,this.editingDashboard=!1,this.parentDiv=document.getElementById(e),this.parentDiv===null&&console.log("Dashboard parent not found"),this.layout=new et,this.dashletIdentities=this.layout.dashlets,this.dashlets=[],this.channels=[],this.paused=!1;let t=localStorage.getItem("dashCadence");t===null?(this.cadence=1,localStorage.setItem("dashCadence",this.cadence.toString())):this.cadence=parseInt(t),this.tickCounter=0,x(this,m,ht).call(this),localStorage.getItem("forceEditMode")&&(localStorage.removeItem("forceEditMode"),requestAnimationFrame(()=>{setTimeout(()=>{this.editMode()})}))}build(){x(this,m,ct).call(this);let e=x(this,m,ut).call(this);this.childIds=[],e.forEach(t=>{this.childIds.push(t.id)}),x(this,m,gt).call(this),e.forEach(t=>{this.parentDiv.appendChild(t)}),x(this,m,mt).call(this),x(this,m,ft).call(this)}editMode(){let e=document.createElement("div");e.classList.add("col-12","bg-secondary-subtle","mb-2"),e.id="dashboardEditingDiv",e.style.padding="10px",e.style.borderRadius="5px",e.style.marginLeft="0";let t=document.getElementById("toasts");this.editingDashboard=!0;let a=document.createElement("div");a.classList.add("row");let i=document.createElement("div");i.classList.add("col-3"),i.appendChild(F("gear","Dashboard Options"));let n=document.createElement("button");n.type="button",n.classList.add("btn","btn-sm","btn-secondary"),n.innerHTML="<i class='fa fa-trash'></i> Remove All",n.onclick=()=>{this.removeAll()},i.appendChild(n);let s=document.createElement("button");s.type="button",s.classList.add("btn","btn-sm","btn-secondary"),s.innerHTML="<i class='fa fa-plus-square'></i> Add All",s.onclick=()=>{this.addAll()},s.style.marginLeft="5px",i.appendChild(s);let r=document.createElement("div");r.classList.add("col-3"),r.appendChild(F("plus","Add Dashboard Item"));let d=document.createElement("div");d.classList.add("dropdown"),d.id="dropdown-widgets";let h=document.createElement("button");h.type="button",h.classList.add("btn","btn-secondary","btn-sm","dropdown-toggle"),h.setAttribute("data-bs-toggle","dropdown"),h.innerHTML="<i class='fa fa-plus'></i> Add Widget",d.appendChild(h);let f=document.createElement("ul");f.classList.add("dropdown-menu","dropdown-menu-sized"),U.forEach(_=>{let O=document.createElement("li"),N=document.createElement("a");N.classList.add("dropdown-item"),N.innerText=_.name;let ne=_.tag;N.onclick=()=>{let W=!1;U.forEach(re=>{re.tag===ne&&(this.dashletIdentities.push(re),W=!0)}),W&&x(this,m,se).call(this)},O.appendChild(N),f.appendChild(O)}),d.appendChild(f),r.appendChild(d);let u=document.createElement("div");u.classList.add("col-3"),u.appendChild(F("save","Save Layout"));let b=document.createElement("div");b.classList.add("input-group");let w=document.createElement("div");w.classList.add("input-group-append");let E=document.createElement("label");E.htmlFor="saveDashName";let y=document.createElement("input");y.id="saveDashName",y.type="text",y.classList.add("form-control","border-0","small");let D=document.createElement("button");D.type="button",D.classList.add("btn","btn-secondary","btn-sm"),D.innerHTML="<i class='fa fa-save'></i>",D.style.marginLeft="4px",D.onclick=()=>{let _=$("#saveDashName").val();if(_.length<1)return;let O={name:_,entries:this.dashletIdentities};$.ajax({type:"POST",url:"/local-api/dashletSave",data:JSON.stringify(O),contentType:"application/json",success:()=>{localStorage.setItem("forceEditMode","true"),window.location.reload()}})},b.appendChild(y),w.appendChild(D),b.appendChild(w),u.appendChild(b);let T=document.createElement("div");T.classList.add("col-3"),T.appendChild(F("cloud","Load Layout"));let C=document.createElement("div");C.classList.add("dropdown");let k=document.createElement("button");k.type="button",k.classList.add("btn","btn-secondary","dropdown-toggle","btn-sm"),k.setAttribute("data-bs-toggle","dropdown"),k.innerHTML="<i class='fa fa-cloud'></i> Load Layout",C.appendChild(k);let M=document.createElement("ul");M.classList.add("dropdown-menu"),M.id="remoteDashletList",C.appendChild(M),T.appendChild(C),$.get("/local-api/dashletThemes",_=>{let O=document.getElementById("remoteDashletList");_.forEach(N=>{let ne=document.createElement("li"),W=document.createElement("a");W.innerText=N;let re=N;W.onclick=()=>{console.log("Loading "+N),$.ajax({type:"POST",url:"/local-api/dashletGet",data:JSON.stringify({theme:re}),contentType:"application/json",success:Tt=>{this.dashletIdentities=Tt,this.layout.save(this.dashletIdentities),localStorage.setItem("forceEditMode","true"),window.location.reload()}})},ne.appendChild(W),O.appendChild(ne)})}),a.appendChild(i),a.appendChild(r),a.appendChild(u),a.appendChild(T),e.appendChild(a),requestAnimationFrame(()=>{setTimeout(()=>{x(this,m,Ke).call(this)})}),t.appendChild(e)}closeEditMode(){let e=document.getElementById("dashboardEditingDiv");e!=null&&e.remove(),this.editingDashboard=!1}fillServerLayoutList(e){let t=document.getElementById("remoteThemes");for(;t.children.length>0;)t.removeChild(t.lastChild);for(let a=0;a<e.length;a++){let i=document.createElement("option");i.innerText=e[a],i.value=e[a],t.appendChild(i)}if(e.length===0){let a=document.createElement("option");a.innerText="No Layouts Saved",a.value="No Layouts Saved",t.appendChild(a),$("#remoteLoadBtn").prop("disabled",!0)}else $("#remoteLoadBtn").prop("disabled",!1)}clickUp(e){let t=this.dashletIdentities[e],a=this.dashletIdentities[e-1];this.dashletIdentities[e-1]=t,this.dashletIdentities[e]=a,x(this,m,se).call(this)}clickDown(e){let t=this.dashletIdentities[e],a=this.dashletIdentities[e+1];this.dashletIdentities[e+1]=t,this.dashletIdentities[e]=a,x(this,m,se).call(this)}clickTrash(e){this.dashletIdentities.splice(e,1),this.layout.save(this.dashletIdentities),localStorage.setItem("forceEditMode","true"),window.location.reload()}zoomIn(e){console.log(e),this.dashletIdentities[e].size<12&&(this.dashletIdentities[e].size+=1),this.layout.save(this.dashletIdentities),localStorage.setItem("forceEditMode","true"),window.location.reload()}zoomOut(e){this.dashletIdentities[e].size>1&&(this.dashletIdentities[e].size-=1),this.layout.save(this.dashletIdentities),localStorage.setItem("forceEditMode","true"),window.location.reload()}removeAll(){this.dashletIdentities=[],this.layout.save(this.dashletIdentities),localStorage.setItem("forceEditMode","true"),window.location.reload()}addAll(){this.dashletIdentities=U,this.layout.save(this.dashletIdentities),localStorage.setItem("forceEditMode","true"),window.location.reload()}};m=new WeakSet,ht=function(){let e=document.createElement("span");e.id=this.divName+"_edit",e.innerHTML="<button type='button' class='btn btn-secondary btn-sm' id='btnEditDash'><i class='fa fa-pencil'></i> Edit</button>",e.onclick=()=>{if(this.editingDashboard){let r=document.getElementById("btnEditDash");r.innerHTML="<i class='fa fa-pencil'></i> Edit",this.closeEditMode()}else{let r=document.getElementById("btnEditDash");r.innerHTML="<i class='fa fa-close'></i> Finish Edit",this.editMode()}};let t=document.getElementById("controls"),a=document.createElement("div");a.id=this.divName+"_cadence";let i=document.createElement("label");i.htmlFor="cadencePicker",i.innerText="Refresh Rate (Seconds): ";let n=document.createElement("input");n.id="cadencePicker",n.type="number",n.min="1",n.max="60",n.value=this.cadence,n.onchange=()=>{this.cadence=parseInt(n.value),localStorage.setItem("dashCadence",this.cadence.toString())},a.appendChild(i),a.appendChild(n);let s=document.createElement("span");s.id=this.divName+"_pause",s.innerHTML="<button type='button' class='btn btn-secondary btn-sm ms-2'><i class='fa fa-pause'></i> Pause</button>",s.onclick=()=>{this.paused=!this.paused;let r=document.getElementById(this.divName+"_pause");this.paused?r.innerHTML="<button type='button' class='btn btn-secondary btn-sm'><i class='fa fa-play'></i> Resume</button>":r.innerHTML="<button type='button' class='btn btn-secondary btn-sm'><i class='fa fa-pause'></i> Pause</button>"},t.appendChild(e),t.appendChild(s),t.appendChild(a)},ct=function(){this.dashlets=[];for(let e=0;e<this.dashletIdentities.length;e++){let t=pt(this.dashletIdentities[e].tag,e);t!=null&&(t.size=this.dashletIdentities[e].size,this.dashlets.push(t))}},ut=function(){let e=[];for(let t=0;t<this.dashlets.length;t++){let a=this.dashlets[t].buildContainer();e.push(a)}return e},mt=function(){this.channels=[];for(let e=0;e<this.dashlets.length;e++){let t=this.dashlets[e].subscribeTo();for(let a=0;a<t.length;a++)x(this,m,bt).call(this,t[a])||this.channels.push(t[a])}},ft=function(){qe(),at(this.channels,e=>{if(e.event==="join")for(let t=0;t<this.dashlets.length;t++)this.dashlets[t].setupOnce(e);else if(!this.paused){this.tickCounter++,this.tickCounter%=this.cadence;for(let t=0;t<this.dashlets.length;t++)this.dashlets[t].canBeSlowedDown()?this.tickCounter===0&&this.dashlets[t].onMessage(e):this.dashlets[t].onMessage(e)}})},bt=function(e){for(let t=0;t<this.channels.length;t++)if(this.channels[t]===e)return!0;return!1},te=function(e,t,a,i,n){let s=document.createElement("div");s.style.position="absolute",s.style.width="20px",s.style.zIndex="200",s.style.height="20px",s.style.top=t,s.style.left=e,s.classList.add("dashEditButton");let r=document.createElement("button");return r.type="button",r.classList.add("btn","btn-sm","btn-"+i),r.innerHTML="<i class='fa fa-"+a+"'></i>",r.onclick=n,s.appendChild(r),s},Ke=function(){document.getElementById("divEditorElements")!==null&&a.remove();let t=document.getElementById("dashboardEditingDiv"),a=document.createElement("div");a.id="divEditorElements";for(let i=0;i<this.childIds.length;i++){let n=document.getElementById(this.childIds[i]);if(n!=null){let s=n.getBoundingClientRect(),r=s.left+4+"px",d=s.right-34+"px",h=s.top+"px",f=s.bottom+"px",u=(s.bottom-s.top)/2+s.top-10+"px",b=(s.right-s.left)/2+s.left-10+"px";if(i>0){let D=i;a.appendChild(x(this,m,te).call(this,r,u,"arrow-circle-left","warning",()=>{this.clickUp(D)}))}if(i<this.childIds.length-1){let D=i;a.appendChild(x(this,m,te).call(this,d,u,"arrow-circle-right","warning",()=>{this.clickDown(D)}))}let w=i;a.appendChild(x(this,m,te).call(this,b,u,"trash","danger",()=>{this.clickTrash(w)}));let E=i;a.appendChild(x(this,m,te).call(this,r,h,"plus-circle","secondary",()=>{this.zoomIn(E)}));let y=i;a.appendChild(x(this,m,te).call(this,s.left+40+"px",h,"minus-circle","secondary",()=>{this.zoomOut(y)}))}else console.log("Warning: NULL div found in dashlet list")}t.appendChild(a)},gt=function(){for(;this.parentDiv.children.length>1;)this.parentDiv.removeChild(this.parentDiv.lastChild)},se=function(){qe(),this.build();let e=this;requestAnimationFrame(()=>{setTimeout(()=>{var t;x(t=e,m,Ke).call(t)})}),this.layout.save(this.dashletIdentities)},St=function(){let e=document.createElement("div");e.id="dashletList",e.style.maxHeight="450px",e.style.overflowY="auto",e.appendChild(F("dashboard","Dashboard Items")),e.appendChild(document.createElement("hr"));let t=document.createElement("table");t.classList.add("table");let a=document.createElement("thead");a.appendChild(l("Item")),a.appendChild(l("Size")),a.appendChild(l("")),a.appendChild(l("")),a.appendChild(l("")),a.appendChild(l("")),a.appendChild(l("")),a.appendChild(l("")),t.appendChild(a);for(let i=0;i<this.dashletIdentities.length;i++){let n=this.dashletIdentities[i],s=document.createElement("tr"),r=document.createElement("td");r.innerText=n.name,s.appendChild(r);let d=document.createElement("td");d.innerText=n.size,s.appendChild(d);let h=document.createElement("td");if(i>0){let M=document.createElement("button");M.type="button",M.classList.add("btn","btn-sm","btn-info"),M.innerHTML="<i class='fa fa-arrow-up'></i>";let _=i;M.onclick=()=>{this.clickUp(_)},h.appendChild(M)}s.appendChild(h);let f=document.createElement("td");if(i<this.dashletIdentities.length-1){let M=document.createElement("button");M.type="button",M.classList.add("btn","btn-sm","btn-info"),M.innerHTML="<i class='fa fa-arrow-down'></i>";let _=i;M.onclick=()=>{this.clickDown(_)},f.appendChild(M)}s.appendChild(f);let u=document.createElement("td"),b=document.createElement("button");b.type="button",b.classList.add("btn","btn-sm","btn-info"),b.innerHTML="<i class='fa fa-plus-circle'></i>";let w=i;b.onclick=()=>{this.zoomIn(w)},u.appendChild(b),s.appendChild(u);let E=document.createElement("td"),y=document.createElement("button");y.type="button",y.classList.add("btn","btn-sm","btn-info"),y.innerHTML="<i class='fa fa-minus-circle'></i>";let D=i;y.onclick=()=>{this.zoomOut(D)},E.appendChild(y),s.appendChild(E);let T=document.createElement("td"),C=document.createElement("button");C.type="button",C.classList.add("btn","btn-sm","btn-warning"),C.innerHTML="<i class='fa fa-trash'></i>";let k=i;C.onclick=()=>{this.clickTrash(k)},T.appendChild(C),s.appendChild(T),t.appendChild(s)}return e.appendChild(t),e},Dt=function(){let e=document.createElement("div");e.classList.add("row");let t=document.createElement("div");t.classList.add("col-6");let a=document.createElement("div");a.appendChild(F("plus","Add Dashboard Item")),a.appendChild(document.createElement("hr"));let i=document.createElement("select");i.id="newWidgetList",i.size=U.length,i.style.width="100%",i.classList.add("listBox"),i.size=8,U.forEach(r=>{let d=document.createElement("option");d.value=r.tag,d.innerText=r.name,d.classList.add("listItem"),i.appendChild(d)}),t.appendChild(i);let n=document.createElement("div");n.classList.add("col-6");let s=document.createElement("button");return s.classList.add("btn","btn-secondary"),s.innerHTML="<i class='fa fa-plus'></i> Add Widget",s.onclick=()=>{let r=$("#newWidgetList").find(":selected").val();if(r==null||r==="")return;let d=!1;U.forEach(h=>{h.tag===r&&(this.dashletIdentities.push(h),d=!0)}),d&&x(this,m,se).call(this)},n.appendChild(s),e.appendChild(t),e.appendChild(n),a.appendChild(e),a};var et=class{constructor(){let e=localStorage.getItem("dashboardLayout");e!==null?this.dashlets=JSON.parse(e):this.dashlets=JSON.parse(kt)}save(e){this.dashlets=e;let t=JSON.stringify(e);localStorage.setItem("dashboardLayout",t)}},kt='[{"name":"Throughput Bits/Second","tag":"throughputBps","size":2},{"name":"Shaped/Unshaped Pie","tag":"shapedUnshaped","size":2},{"name":"Throughput Packets/Second","tag":"throughputPps","size":2},{"name":"Tracked Flows Counter","tag":"trackedFlowsCount","size":2},{"name":"Last 5 Minutes Throughput","tag":"throughputRing","size":2},{"name":"Round-Trip Time Histogram","tag":"rttHistogram","size":2},{"name":"Network Tree Sankey","tag":"networkTreeSankey","size":6},{"name":"Network Tree Summary","tag":"treeSummary","size":6},{"name":"Top 10 Downloaders","tag":"top10downloaders","size":6},{"name":"Worst 10 Round-Trip Time","tag":"worst10downloaders","size":6},{"name":"Worst 10 Retransmits","tag":"worst10retransmits","size":6},{"name":"Top 10 Flows (total bytes)","tag":"top10flowsBytes","size":6},{"name":"Top 10 Flows (rate)","tag":"top10flowsRate","size":6},{"name":"Top 10 Endpoints by Country","tag":"top10endpointsCountry","size":6},{"name":"Ether Protocols","tag":"etherProtocols","size":6},{"name":"IP Protocols","tag":"ipProtocols","size":6},{"name":"CPU Utilization","tag":"cpu","size":3},{"name":"RAM Utilization","tag":"ram","size":3},{"name":"Combined Top 10 Box","tag":"combinedTop10","size":6},{"name":"Total Cake Stats","tag":"totalCakeStats","size":6},{"name":"Circuits At Capacity","tag":"circuitCapacity","size":6},{"name":"Tree Nodes At Capacity","tag":"treeCapacity","size":6}]';function wt(o){$.get("/local-api/versionCheck",e=>{if(e==="Update available"){let t=document.createElement("div");t.innerHTML="<i class='fa fa-info-circle'></i> A New Version of LibreQoS is Available",t.classList.add("alert","alert-success"),document.getElementById(o).appendChild(t)}})}var oe="<a href=\"https://github.com/sponsors/LibreQoE/\" target='_blank' class='text-primary-emphasis'><i class=\"fa fa-heart\"></i> Sponsor Us on GitHub</a>";function Ct(o){$.get("/local-api/ltsCheck",e=>{$.get("/local-api/deviceCount",t=>{if(e.action!=="GoodToGo"){let a=document.createElement("div"),i=Math.floor(Math.random()*5)+1;if(i===1){let s="We love working on LibreQoS to make the Internet better. If you love it too, please ";s+=oe,s+=". By the way, we'll stop asking if you sign up for LTS (Long-Term Stats).",a.innerHTML=s}else if(i===2){let r="Other QoS providers might be charging you as much as $"+(Math.max(100,t.shaped_devices)*.6).toFixed(2)+" per month. We like eating, too! Why not ";r+=oe,r+=". By the way, we'll stop asking if you sign up for LTS (Long-Term Stats).",a.innerHTML=r}else if(i===3){let s="Open Source is a labor of love. If you love LibreQoS, please ";s+=oe,s+=". By the way, we'll stop asking if you sign up for LTS (Long-Term Stats).",a.innerHTML=s}else if(i===4){let s=t.shaped_devices+" devices on your network are using LibreQoS. If we're helping, please ";s+=oe,s+=". By the way, we'll stop asking if you sign up for LTS (Long-Term Stats).",a.innerHTML=s}else if(i===5){let s="$150 will keep a developer in Ramen for a month! ";s+=oe,s+=". By the way, we'll stop asking if you sign up for LTS (Long-Term Stats).",a.innerHTML=s}a.classList.add("alert","alert-warning"),document.getElementById(o).appendChild(a)}})})}function yt(){$.get("/local-api/globalWarnings",o=>{let e=document.getElementById("toasts");o.forEach(t=>{let a=document.createElement("div");a.classList.add("alert");let i=t[1],n="<fa class='fa fa-exclamation-triangle'></fa>";switch(t[0]){case"Info":n="<fa class='fa fa-info-circle'></fa>",a.classList.add("alert-info");break;case"Warning":n="<fa class='fa fa-exclamation-triangle'></fa>",a.classList.add("alert-warning");break;case"Error":n="<fa class='fa fa-exclamation-circle'></fa>",a.classList.add("alert-danger");break;default:a.classList.add("alert-warning");break}a.innerHTML=n+" "+i,e.appendChild(a)})})}wt("toasts");Ct("toasts");yt();var It=new Ve("dashboard");It.build();})();
//# sourceMappingURL=index.js.map
